{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>01.-DHCP</p>"},{"location":"01.-KVM/","title":"Index","text":"<p>Las m\u00e1quinas virtuales basadas en el kernel (KVM) son una tecnolog\u00eda de virtualizaci\u00f3n open source integrada a Linux\u00ae. Con ellas, se puede transformar Linux en un hipervisor que permite que una m\u00e1quina host ejecute varios entornos virtuales aislados llamados m\u00e1quinas virtuales (VM) o guests.</p> <p>Las KVM forman parte de Linux. Por eso, si se cuenta con una versi\u00f3n de Linux 2.6.20 o posterior, ya est\u00e1n a nuestra a su disposici\u00f3n. Se anunciaron por primera vez en 2006, y un a\u00f1o despu\u00e9s se incorporaron a la versi\u00f3n principal del kernel de Linux. Dado que forman parte del c\u00f3digo actual de Linux, reciben inmediatamente todas las mejoras, las correcciones y las funciones nuevas de este  sistema, sin requerir ning\u00fan tipo de ingenier\u00eda adicional.</p> <p></p> <p>https://www.pinguytaz.net/index.php/2021/08/06/usando-qemu-kvm-con-libvirt-1-6/</p>"},{"location":"01.-KVM/01.-Red/","title":"Index","text":"<p>Los ficheros de configuraci\u00f3n de las redes los encontraremos en:</p> <p><code>/etc/libvirt/qemu/networks/*.xml</code></p> <p>El componete principal del las redes libvirt son los  \u201cSwitches-Virtuales\u201d, conmutador de red virtual, al que las m\u00e1quinas conectaran sus NIC's virtuales (vNIC).</p> <p></p> <p>Si vemos nuestros interfaces locales veremos que tenemos uno o varios dispositivos <code>virbrX</code>, esto son los Switches-Virtuales, y un dispositivo (vnetX) por cada vNIC que este levantado en las maquinas virtuales. Aunque esto nos lo proporciona directamente virt-manager, m\u00e1s adelante veremos ex\u00e1ctamente c\u00f3mo crear las redes, en la opci\u00f3n Editar\u2192Detalles_Conexi\u00f3n dentro de la carpeta \u201cRedes Virtuales\u201d.</p> <p></p> <p>Desde la l\u00ednea de comandos podremos crear estos dispositivos de la siguiente forma:</p> <pre><code>brctl addbr // Switch Virtual\n\n// Los vNICs tipo TIN/TAP\nip tuntap add dev mode tap\nbrctl addif\n</code></pre>"},{"location":"01.-KVM/01.-Red/01.-Modos%20de%20red%20en%20KVM/","title":"01.-Modos de red en KVM","text":""},{"location":"01.-KVM/01.-Red/01.-Modos%20de%20red%20en%20KVM/#nat-network-address-translation","title":"NAT (Network Address Translation)","text":"<p>Es el modo predeterminado. Las VMs pueden acceder a la red externa, pero no son directamente accesibles desde fuera. Utiliza iptables para enmascarar el tr\u00e1fico de las VMs.</p> <ul> <li>Caso de uso: Entorno de desarrollo donde las VMs necesitan acceso a Internet pero no requieren ser accesibles desde fuera.</li> <li>Ejemplo: Un desarrollador ejecutando m\u00faltiples VMs para probar diferentes configuraciones de software.</li> </ul>"},{"location":"01.-KVM/01.-Red/01.-Modos%20de%20red%20en%20KVM/#bridge-mode","title":"Bridge Mode","text":"<p>Conecta las VMs directamente a la red f\u00edsica del host. Las VMs aparecen como dispositivos independientes en la red.</p> <ul> <li>Caso de uso: Servidores virtuales que necesitan aparecer como dispositivos independientes en la red local.</li> <li>Ejemplo: Una peque\u00f1a empresa virtualizando sus servidores de correo, web y base de datos, cada uno con su propia direcci\u00f3n IP en la LAN.</li> </ul>"},{"location":"01.-KVM/01.-Red/01.-Modos%20de%20red%20en%20KVM/#routed-mode","title":"Routed Mode","text":"<p>Crea una red virtual separada para las VMs. El host act\u00faa como router entre la red virtual y la red f\u00edsica.</p> <ul> <li>Caso de uso: Crear una subred aislada para un grupo de VMs con acceso controlado a la red principal.</li> <li>Ejemplo: Un laboratorio de pruebas de seguridad donde se necesita aislar las VMs potencialmente maliciosas.</li> </ul>"},{"location":"01.-KVM/01.-Red/01.-Modos%20de%20red%20en%20KVM/#isolated-mode","title":"Isolated Mode","text":"<p>Las VMs pueden comunicarse entre s\u00ed y con el host, pero no tienen acceso a la red externa. \u00datil para entornos de prueba o simulaciones aisladas.</p> <ul> <li>Caso de uso: Entornos de prueba completamente aislados sin acceso a redes externas.</li> <li>Ejemplo: Simulaci\u00f3n de una red corporativa para entrenamiento de personal de TI sin riesgo de afectar la red real.</li> </ul>"},{"location":"01.-KVM/01.-Red/01.-Modos%20de%20red%20en%20KVM/#macvtap","title":"MacVTap","text":"<p>Permite que las VMs se conecten directamente a la interfaz f\u00edsica del host. Ofrece mejor rendimiento que el modo bridge en algunos casos.</p> <ul> <li>Caso de uso: VMs que requieren alto rendimiento de red y acceso directo a la interfaz f\u00edsica.</li> <li>Ejemplo: Un servidor de streaming de video virtualizado que necesita m\u00e1ximo ancho de banda.</li> </ul>"},{"location":"01.-KVM/01.-Red/01.-Modos%20de%20red%20en%20KVM/#pci-passthrough","title":"PCI Passthrough","text":"<p>Asigna un dispositivo de red f\u00edsico directamente a una VM. Proporciona el mejor rendimiento, pero limita la flexibilidad.</p> <ul> <li>Caso de uso: VM que requiere acceso exclusivo y de alto rendimiento a una NIC f\u00edsica.</li> <li>Ejemplo: Un firewall virtualizado que necesita control total sobre una interfaz de red dedicada.</li> </ul>"},{"location":"01.-KVM/01.-Red/01.-Modos%20de%20red%20en%20KVM/#vlan-virtual-lan","title":"VLAN (Virtual LAN)","text":"<p>Permite crear redes virtuales separadas sobre la misma infraestructura f\u00edsica. \u00datil para aislar el tr\u00e1fico entre diferentes grupos de VMs.</p> <ul> <li>Caso de uso: Separar el tr\u00e1fico de diferentes departamentos o clientes en una infraestructura virtualizada compartida.</li> <li>Ejemplo: Un proveedor de servicios gestionados que ofrece entornos virtuales aislados para m\u00faltiples clientes.</li> </ul>"},{"location":"01.-KVM/01.-Red/01.-Modos%20de%20red%20en%20KVM/#open-vswitch","title":"Open vSwitch","text":"<p>Un switch virtual que ofrece capacidades avanzadas de networking. Soporta VLAN, t\u00faneles, y pol\u00edticas de red m\u00e1s complejas.</p> <ul> <li>Caso de uso: Implementaci\u00f3n de redes definidas por software (SDN) en un entorno de nube privada.</li> <li>Ejemplo: Un centro de datos virtualizado que requiere pol\u00edticas de red complejas y din\u00e1micas entre cientos de VMs.</li> </ul> <p>Como has podido comprobar, cada modo tiene sus propias ventajas y casos de uso  espec\u00edficos, permitiendo a los administradores de sistemas configurar la red de las VMs de manera flexible seg\u00fan las necesidades del entorno.</p>"},{"location":"01.-KVM/01.-Red/01.-Modos%20de%20red%20en%20KVM/#componentes-clave","title":"Componentes clave","text":"<ol> <li>Hipervisor: KVM convierte el kernel de Linux en un hipervisor tipo 1.</li> <li>QEMU: Emulador que trabaja en conjunto con KVM para proporcionar virtualizaci\u00f3n completa.</li> <li>libvirt: Capa de gesti\u00f3n que facilita la configuraci\u00f3n y ejecuci\u00f3n de VMs.</li> <li>Bridges: Utilizados para conectar las interfaces virtuales (TAPs) con las interfaces f\u00edsicas.</li> <li>TAPs: Interfaces de software que emulan las NICs virtuales de las VMs.</li> </ol>"},{"location":"01.-KVM/01.-Red/03.-Configuraci%C3%B3n%20de%20red%20en%20modo%20bridge/","title":"03.-Configuraci\u00f3n de red en modo bridge","text":"<p>Primero, aseg\u00farate de tener instalados los paquetes necesarios:</p> <pre><code>sudo apt install bridge-utils\n</code></pre> <p>Edita el archivo <code>/etc/network/interfaces</code> en tu host Linux para crear un bridge:</p> <pre><code>auto br0\niface br0 inet dhcp\n    bridge_ports eth0\n    bridge_stp off\n    bridge_fd 0\n</code></pre> <p>Reemplaza <code>eth0</code> con el nombre de tu interfaz de red f\u00edsica. Reinicia el servicio de red:</p> <pre><code>sudo systemctl restart networking\n</code></pre> <p>Modifica la configuraci\u00f3n de tus m\u00e1quinas virtuales:</p> <p>a. Det\u00e9n las m\u00e1quinas virtuales.</p> <p>b. Abre virt-manager.</p> <p>c. Para cada VM, ve a la configuraci\u00f3n de hardware.</p> <p>d. En la secci\u00f3n NIC, cambia la fuente de red a \"Bridge br0\".</p> <p>Inicia las m\u00e1quinas virtuales.</p>"},{"location":"01.-KVM/01.-Red/03.-Configuraci%C3%B3n%20de%20red%20en%20modo%20bridge/#verificacion","title":"Verificaci\u00f3n","text":"<p>Despu\u00e9s de estos cambios:</p> <ul> <li>Las VMs deber\u00edan obtener direcciones IP en el mismo rango que tu red local.</li> <li>Deber\u00edas poder hacer ping entre las VMs y desde las VMs al host.</li> <li>Las VMs deber\u00edan ser accesibles desde otros dispositivos en tu red local.</li> </ul>"},{"location":"01.-KVM/01.-Red/03.-Configuraci%C3%B3n%20de%20red%20en%20modo%20bridge/#consideraciones-adicionales","title":"Consideraciones adicionales","text":"<ul> <li>Aseg\u00farate de que tu firewall no est\u00e9 bloqueando el tr\u00e1fico entre las VMs.</li> <li>Si las VMs usan IPs est\u00e1ticas, config\u00faralas en el mismo rango de tu red local.</li> <li>Para una configuraci\u00f3n m\u00e1s avanzada, puedes crear un bridge personalizado en <code>libvirt</code>:</li> </ul> <pre><code>    sudo virsh net-define /path/to/bridge-network.xml\n    sudo virsh net-start bridge-network\n    sudo virsh net-autostart bridge-network\n</code></pre> <p>Donde <code>bridge-network.xml</code> contiene la definici\u00f3n de tu red bridge.</p> <p>Con esta configuraci\u00f3n, tus m\u00e1quinas virtuales deber\u00edan estar en modo bridge y podr\u00e1s hacer ping entre ellas como si fueran m\u00e1quinas f\u00edsicas en la misma red local.</p>"},{"location":"01.-KVM/01.-Red/04.-Configurar%20el%20interfaz%20puente%20con%20NetworkManager/","title":"04.-Configurar el interfaz puente con NetworkManager","text":"<p>Si tenemos el directorio <code>/etc/NetworkManager</code> en el sistema Linux indica que estamos utilizando NetworkManager para gestionar nuestras conexiones de red, lo cual es com\u00fan en muchas distribuciones Linux  modernas, incluyendo Arch. Para configurar un bridge para KVM utilizando NetworkManager, seguiremos estos pasos:</p> <ol> <li>Instalaremos los paquetes necesarios si a\u00fan no se ha hecho:</li> </ol> <pre><code>sudo pacman -S networkmanager bridge-utils\n</code></pre> <ol> <li>Crearemo un nuevo bridge usando NetworkManager:</li> </ol> <pre><code>sudo nmcli con add type bridge con-name br0 ifname br0\n</code></pre> <ol> <li>A\u00f1ada su interfaz f\u00edsica al bridge (reemplace 'eno1' con el nombre de su interfaz):</li> </ol> <pre><code>sudo nmcli con add type bridge-slave con-name eno1 ifname eno1 master br0\n</code></pre> <ol> <li>Configure el bridge para usar DHCP:</li> </ol> <pre><code>sudo nmcli con modify br0 ipv4.method auto\n</code></pre> <ol> <li>Desactive la conexi\u00f3n de la interfaz f\u00edsica y active el bridge:</li> </ol> <pre><code>sudo nmcli con down eno1\nsudo nmcli con up br0\n</code></pre> <ol> <li>Aseg\u00farese de que NetworkManager se inicie al arrancar el sistema:</li> </ol> <pre><code>bashsudo systemctl enable NetworkManager\nsudo systemctl start NetworkManager\n</code></pre> <ol> <li>Para configurar sus m\u00e1quinas virtuales KVM para usar este bridge, edite la configuraci\u00f3n XML de cada VM:</li> </ol> <pre><code>bash\nsudo virsh edit nombre_de_su_vm\n</code></pre> <p>Modifique la secci\u00f3n <code>&lt;interface&gt;</code>:</p> <pre><code>xml&lt;interface type='bridge'&gt;\n  &lt;source bridge='br0'/&gt;\n  &lt;model type='virtio'/&gt;\n&lt;/interface&gt;\n</code></pre> <ol> <li>Reinicie las m\u00e1quinas virtuales para que tomen la nueva configuraci\u00f3n:</li> </ol> <pre><code>bashsudo virsh shutdown nombre_de_su_vm\nsudo virsh start nombre_de_su_vm\n</code></pre> <p>Despu\u00e9s de estos pasos, sus m\u00e1quinas virtuales deber\u00edan obtener  direcciones IP de la red externa 172.30.0.0/16 a trav\u00e9s del bridge br0.Recuerde que al usar este m\u00e9todo, est\u00e1 exponiendo directamente sus m\u00e1quinas virtuales a la red externa, as\u00ed que aseg\u00farese de configurar  adecuadamente la seguridad de las VMs.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/","title":"05.-Configurar red en modo bridge","text":"<p>Queremos configurar nuestras m\u00e1quinas virtuales para que obtengan direcciones IP de un servidor DHCP externo mediante una red bridge en KVM/QEMU, utilizando NetworkManager en un host Linux. Opcionalmente, queremos aislar al host de la red local utilizada por las m\u00e1quinas virtuales.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#vision-general","title":"Visi\u00f3n General","text":"<ol> <li>Crear y configurar un Bridge con NetworkManager: Esto permitir\u00e1 que las m\u00e1quinas virtuales se conecten directamente a la red f\u00edsica y obtengan direcciones IP del servidor DHCP externo.</li> <li>Configurar las M\u00e1quinas Virtuales para Usar el Bridge: Asignar el bridge reci\u00e9n creado a las interfaces de red de las VMs.</li> <li>Opcional: Aislar el Host de la Red del Bridge: Implementar reglas de firewall para impedir que el host se comunique con las m\u00e1quinas virtuales en el bridge.</li> </ol>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#crear-y-configurar-un-bridge-con-networkmanager","title":"Crear y Configurar un Bridge con NetworkManager","text":""},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#identificar-la-interfaz-de-red-fisica","title":"Identificar la Interfaz de Red F\u00edsica","text":"<p>Primero, necesitamos identificar la interfaz de red f\u00edsica que est\u00e1 conectada a tu red local. Podemos hacerlo ejecutando:<code>ip a</code> \u00f3 <code>ip link</code> \u00f3 <code>nmcli</code>. Buscamos  la interfaz que est\u00e1 conectada a nuestra red, por ejemplo, <code>eth0</code>, <code>enp3s0</code>, etc.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#crear-el-bridge-utilizando-nmcli","title":"Crear el Bridge Utilizando nmcli","text":"<p>Usaremos la l\u00ednea de comandos para crear y configurar el bridge. Supongamos que nuestra interfaz f\u00edsica es <code>enp3s0</code>.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#crear-el-bridge-br0","title":"Crear el Bridge br0","text":"<pre><code>nmcli connection add type bridge autoconnect yes con-name br0 ifname br0\n</code></pre>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#agregar-la-interfaz-fisica-al-bridge","title":"Agregar la Interfaz F\u00edsica al Bridge","text":"<pre><code>nmcli connection add type bridge-slave autoconnect yes con-name enp3s0-slave ifname enp3s0 master br0\n</code></pre>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#configurar-el-bridge-para-obtener-una-ip-mediante-dhcp","title":"Configurar el Bridge para Obtener una IP mediante DHCP","text":"<p>Esto permitir\u00e1 que el bridge br0 obtenga una direcci\u00f3n IP del servidor DHCP externo.</p> <pre><code>nmcli connection modify br0 ipv4.method auto\nnmcli connection modify br0 ipv6.method ignore\n</code></pre>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#activar-las-conexiones","title":"Activar las Conexiones","text":"<pre><code>    nmcli connection up br0\n    nmcli connection up enp3s0-slave\n</code></pre>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#verificar-la-configuracion-del-bridge","title":"Verificar la Configuraci\u00f3n del Bridge","text":"<p>Despu\u00e9s de configurar el bridge, verifica que br0 est\u00e9 activo y tenga una direcci\u00f3n IP asignada:</p> <pre><code>ip addr show br0\n</code></pre> <p>Deber\u00edas ver una direcci\u00f3n IP obtenida del servidor DHCP externo.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#configurar-las-maquinas-virtuales-para-usar-el-bridge","title":"Configurar las M\u00e1quinas Virtuales para Usar el Bridge","text":"<p>Ahora, configuraremos las m\u00e1quinas virtuales para que utilicen el bridge br0 que acabas de crear, permiti\u00e9ndoles obtener direcciones IP del mismo servidor DHCP que usa el host.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#usando-virsh","title":"Usando virsh","text":""},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#apagar-la-maquina-virtual-si-esta-en-ejecucion","title":"Apagar la M\u00e1quina Virtual (si est\u00e1 en ejecuci\u00f3n):","text":"<pre><code>virsh shutdown &lt;nombre_de_vm&gt;\n</code></pre>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#editar-la-configuracion-de-la-maquina-virtual","title":"Editar la Configuraci\u00f3n de la M\u00e1quina Virtual:","text":"<p>Puedes editar el archivo XML de la VM para cambiar la interfaz de red para usar el bridge br0.</p> <pre><code>virsh edit &lt;nombre_de_vm&gt;\n</code></pre> <p>Busca la secci\u00f3n  y modif\u00edcala de la siguiente manera: <pre><code>&lt;interface type='bridge'&gt;\n  &lt;mac address='52:54:00:xx:xx:xx'/&gt;\n  &lt;source bridge='br0'/&gt;\n  &lt;model type='virtio'/&gt;\n  &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;\n&lt;/interface&gt;\n</code></pre> <p>Aseg\u00farate de reemplazar 52:54:00:xx:xx:xx con la direcci\u00f3n MAC de tu VM si es necesario.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#iniciar-la-maquina-virtual","title":"Iniciar la M\u00e1quina Virtual:","text":"<pre><code>    virsh start &lt;nombre_de_vm&gt;\n</code></pre>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#usando-virt-manager-interfaz-grafica","title":"Usando virt-manager (Interfaz Gr\u00e1fica)","text":""},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#abrir-virt-manager","title":"Abrir virt-manager:","text":"<pre><code>    virt-manager\n</code></pre>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#seleccionar-la-maquina-virtual-y-acceder-a-sus-detalles","title":"Seleccionar la M\u00e1quina Virtual y Acceder a sus Detalles:","text":"<ul> <li>Selecciona la VM que deseas configurar.</li> <li>Hacer clic derecho y seleccionar Detalles.</li> </ul>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#modificar-la-configuracion-de-la-interfaz-de-red","title":"Modificar la Configuraci\u00f3n de la Interfaz de Red:","text":"<ul> <li>En la secci\u00f3n Hardware, seleccionar NIC o Interfaz de red.</li> <li>Cambiar el tipo de conexi\u00f3n a Bridge <code>br0</code>.</li> <li>Guardar los cambios.</li> </ul>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#iniciar-la-maquina-virtual_1","title":"Iniciar la M\u00e1quina Virtual:","text":"<p>Iniciar la VM y verificar que obtiene una IP del servidor DHCP externo.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#aislar-el-host-de-la-red-del-bridge-opcional","title":"Aislar el Host de la Red del Bridge (Opcional)","text":"<p>Aunque el host est\u00e1 conectado al bridge <code>br0</code>, podemos aislarlo de las m\u00e1quinas virtuales utilizando reglas de iptables para bloquear el tr\u00e1fico entre el host y las VMs.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#identificar-el-rango-de-ip-del-bridge","title":"Identificar el Rango de IP del Bridge","text":"<p>Supongamos que el bridge <code>br0</code> est\u00e1 en la subred 192.168.1.0/24. Aseg\u00farate de ajustar las reglas seg\u00fan tu subred real.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#implementar-reglas-de-firewall-con-iptables","title":"Implementar Reglas de Firewall con iptables","text":"<p>Bloquear Todo el Tr\u00e1fico Entrante desde <code>br0</code> al Host:</p> <pre><code>sudo iptables -A INPUT -i br0 -j DROP\n</code></pre> <p>Bloquear Todo el Tr\u00e1fico Saliente desde el Host hacia <code>br0</code>:</p> <pre><code>sudo iptables -A OUTPUT -o br0 -j DROP\n</code></pre>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#guardar-las-reglas-de-iptables-para-persistencia","title":"Guardar las Reglas de iptables para Persistencia:","text":"<p>Dependiendo de tu distribuci\u00f3n, puedes usar <code>iptables-persistent</code> o guardar manualmente las reglas.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#usando-iptables-persistent","title":"Usando iptables-persistent","text":"<pre><code>        sudo pacman -S iptables-nft iptables-persistent\n        sudo netfilter-persistent save\n</code></pre>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#manual","title":"Manual","text":"<p>A\u00f1ade las reglas al archivo de configuraci\u00f3n de iptables que se carga al inicio.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#verificar-las-reglas-de-firewall","title":"Verificar las Reglas de Firewall","text":"<p>Despu\u00e9s de aplicar las reglas, verifica que est\u00e9n activas:</p> <pre><code>sudo iptables -L -v\n</code></pre> <p>Deber\u00edas ver las reglas que has a\u00f1adido en las cadenas INPUT y OUTPUT para la interfaz br0.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#consideraciones-adicionales","title":"Consideraciones Adicionales","text":""},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#permitir-trafico-saliente-desde-las-vms-hacia-internet","title":"Permitir Tr\u00e1fico Saliente desde las VMs hacia Internet","text":"<p>Si las VMs necesitan acceder a Internet, aseg\u00farate de que las reglas de firewall no bloqueen el tr\u00e1fico saliente desde br0 hacia fuera. Las reglas anteriores solo bloquean el tr\u00e1fico del host hacia y desde br0.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#limitar-el-numero-de-macs-por-puerta-de-enlace-opcional","title":"Limitar el N\u00famero de MACs por Puerta de Enlace (Opcional)","text":"<p>Algunos switches o puntos de acceso tienen l\u00edmites en la cantidad de direcciones MAC que pueden ser aprendidas por puerto. Aseg\u00farate de que tu infraestructura de red soporte m\u00faltiples MACs por puerto, que es esencial para el funcionamiento correcto del bridge con m\u00faltiples VMs.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#usar-firewalld-en-lugar-de-iptables-opcional","title":"Usar <code>firewalld</code> en lugar de <code>iptables</code> (Opcional)","text":"<p>Podemos usar <code>firewalld</code>para gestionar las reglas de firewall donde cabe implementar pol\u00edticas similares utilizando zonas y reglas espec\u00edficas.</p>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#verificacion-final","title":"Verificaci\u00f3n Final","text":"<ol> <li>Verificar la Conectividad de las VMs:</li> <li>Inicia una VM y verifica que obtiene una direcci\u00f3n IP del servidor DHCP externo.</li> <li> <p>Comprueba que la VM puede acceder a Internet y a otros recursos de la red seg\u00fan lo esperado.</p> </li> <li> <p>Verificar la Aislamiento del Host:</p> </li> <li>Desde el host, intenta hacer ping a la direcci\u00f3n IP de la VM. Deber\u00eda fallar debido a las reglas de firewall.</li> <li> <p>Desde la VM, intenta hacer ping al host. Deber\u00eda fallar tambi\u00e9n.</p> </li> <li> <p>Verificar que las VMs No Pueden Comunicarse Entre S\u00ed (Opcional):</p> </li> <li>Si deseas aislar completamente a las VMs entre s\u00ed, puedes implementar reglas adicionales de firewall o configurar la red de las VMs en modo aislado.</li> </ol>"},{"location":"01.-KVM/01.-Red/05.-Configurar%20red%20en%20modo%20bridge/#resumen","title":"Resumen","text":"<ul> <li>Hemos creado un bridge <code>br0</code> utilizando NetworkManager y asignado la interfaz f\u00edsica como esclava.</li> <li>Configuramos las m\u00e1quinas virtuales para que utilicen el bridge <code>br0</code>, permiti\u00e9ndoles obtener direcciones IP de un servidor DHCP externo.</li> <li>Implementamos reglas de firewall con <code>iptables</code> para aislar el host de la red del bridge, impidiendo la comunicaci\u00f3n entre el host y las m\u00e1quinas virtuales.</li> </ul> <p>Esta configuraci\u00f3n asegura que tus m\u00e1quinas virtuales est\u00e9n en la misma red f\u00edsica que el host y puedan obtener direcciones IP del servidor DHCP externo, mientras que el host permanece aislado de dichas m\u00e1quinas.</p>"},{"location":"01.-KVM/01.-Red/NetPlan%20vs%20Network%20Manager%20vs%20systemd/","title":"NetPlan vs Network Manager vs systemd","text":"<p>\u200b    Netplan:  </p> <p>\u200b    Netplan es un renderizador de abstracci\u00f3n de configuraci\u00f3n de red  utilizado en las versiones modernas de Ubuntu (desde 17.10). Proporciona una interfaz de configuraci\u00f3n de alto nivel basada en YAML para definir interfaces de red y configuraciones. Netplan genera archivos de  configuraci\u00f3n de red en el formato que entiende el subsistema de red  subyacente, que puede ser networkd o NetworkManager. Netplan es la forma recomendada de configurar la configuraci\u00f3n de red en Ubuntu,  independientemente de si est\u00e1 utilizando un servidor o un entorno de  escritorio. Es la herramienta de configuraci\u00f3n de front-end.  systemd-networkd (networkd):  </p> <p>\u200b    systemd-networkd es un componente de systemd, el sistema init  utilizado en Ubuntu (y muchas otras distribuciones de Linux).  Proporciona un servicio de configuraci\u00f3n de red minimalista y de bajo  nivel dise\u00f1ado para casos de uso de servidor. Networkd es adecuado para  servidores sin cabeza y otros entornos donde se necesita una soluci\u00f3n de configuraci\u00f3n de red ligera y predecible. Cuando configura la red a  trav\u00e9s de Netplan, puede optar por utilizar networkd como backend para  la gesti\u00f3n de la red. NetworkManager:  </p> <p>\u200b    NetworkManager es una soluci\u00f3n de gesti\u00f3n de red m\u00e1s completa y  f\u00e1cil de usar. Se asocia com\u00fanmente con entornos de escritorio porque  ofrece una interfaz gr\u00e1fica de usuario para administrar conexiones de  red. Sin embargo, NetworkManager no se limita al uso de escritorio.  Tambi\u00e9n se puede utilizar en servidores, especialmente si necesita  funciones de red avanzadas o si su servidor tiene una combinaci\u00f3n de  conexiones cableadas e inal\u00e1mbricas. NetworkManager tambi\u00e9n se puede  utilizar en combinaci\u00f3n con Netplan. Elegir entre networkd y  NetworkManager en servidores:  </p> <p>\u200b    Para entornos de servidor, la elecci\u00f3n entre networkd y  NetworkManager depende de sus requisitos espec\u00edficos. Si prefiere una  configuraci\u00f3n de red simple, ligera y predecible, networkd es una buena  opci\u00f3n. Es especialmente adecuado para servidores sin cabeza. Si  necesita funciones de gesti\u00f3n de red m\u00e1s avanzadas, especialmente para  manejar escenarios de red complejos o conexiones cableadas/inal\u00e1mbricas  mixtas, NetworkManager podr\u00eda ser una mejor opci\u00f3n. Puede configurar  networkd o NetworkManager como backend para Netplan especific\u00e1ndolo en  su archivo de configuraci\u00f3n YAML de Netplan (renderer: networkd o  renderer: NetworkManager). En su caso, si tiene una instalaci\u00f3n nueva de Ubuntu 20.04, es com\u00fan ver que NetworkManager maneja la configuraci\u00f3n  de red de forma predeterminada, incluso en servidores. Puede cambiar a  networkd si prefiere una configuraci\u00f3n m\u00e1s simple o si NetworkManager no cumple con sus requisitos espec\u00edficos.  </p> <p>\u200b    En resumen, si bien NetworkManager a menudo se asocia con entornos  de escritorio, es una herramienta vers\u00e1til que tambi\u00e9n se puede utilizar eficazmente en servidores, especialmente cuando se necesitan funciones  de gesti\u00f3n de red m\u00e1s avanzadas. La elecci\u00f3n entre networkd y  NetworkManager depende de su caso de uso espec\u00edfico y preferencias.  Netplan sirve como una capa de configuraci\u00f3n conveniente y estandarizada para ambos backends.  </p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/01.-Introducci%C3%B3n%20a%20las%20redes%20en%20linux/","title":"01.-Introducci\u00f3n a las redes en linux","text":"<p>Antes de sumergirnos en puentes e interfaces virtuales, es \u00fatil entender c\u00f3mo se gestionan las redes en Linux:</p> <ul> <li>Interfaces F\u00edsicas: Son las tarjetas de red reales del sistema, como <code>eth0</code>, <code>enp0s25</code>, <code>wlan0</code>, etc.</li> <li>Interfaces Virtuales: Son interfaces creadas por software para prop\u00f3sitos espec\u00edficos, como virtualizaci\u00f3n, t\u00faneles VPN, o puentes de red. Ejemplos:  <code>br0</code> (bridge), <code>vnet0</code> (interfaz de VM), <code>tun0</code> (t\u00fanel VPN), etc.</li> <li>Herramientas de Gesti\u00f3n: En Linux, puedes gestionar las redes usando herramientas como <code>ip</code>, <code>ifconfig</code> (m\u00e1s antiguo), <code>bridge-utils</code>, <code>nmcli</code> (NetworkManager), entre otras.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/02.-Puentes%20de%20Red%20%28Network%20Bridges%29/","title":"02.-Puentes de Red (Network Bridges)","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/02.-Puentes%20de%20Red%20%28Network%20Bridges%29/#que-es-un-puente-de-red","title":"\u00bfQu\u00e9 es un Puente de Red?","text":"<p>Un puente de red (bridge) es un dispositivo de red virtual que opera en la capa 2 (Enlace de Datos) del modelo OSI. Su funci\u00f3n principal es conectar m\u00faltiples segmentos de red como si fueran una sola red f\u00edsica. En t\u00e9rminos m\u00e1s simples, un bridge permite que diferentes interfaces de red se comuniquen entre s\u00ed directamente.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/02.-Puentes%20de%20Red%20%28Network%20Bridges%29/#como-funcionan-los-puentes","title":"\u00bfC\u00f3mo Funcionan los Puentes?","text":"<ul> <li>Operaci\u00f3n en Capa 2: Al funcionar en la capa de enlace de datos, los puentes trabajan con direcciones MAC para filtrar y reenviar tr\u00e1fico.</li> <li>Aprendizaje de MACs: Un bridge mantiene una tabla de direcciones MAC aprendidas, asociando cada MAC con una interfaz espec\u00edfica. Esto permite que el bridge reenv\u00ede el tr\u00e1fico solo al destino correcto, reduciendo el tr\u00e1fico innecesario.</li> <li>Transparencia: Para los dispositivos conectados al bridge, parece que est\u00e1n todos en la misma red f\u00edsica, aunque est\u00e9n conectados a diferentes interfaces f\u00edsicas o virtuales.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/02.-Puentes%20de%20Red%20%28Network%20Bridges%29/#uso-de-puentes-en-virtualizacion","title":"Uso de Puentes en Virtualizaci\u00f3n","text":"<p>En el contexto de la virtualizaci\u00f3n (como con KVM/QEMU):</p> <ul> <li>Conexi\u00f3n Directa a la Red F\u00edsica: Al conectar las interfaces de las m\u00e1quinas virtuales a un bridge, estas pueden comunicarse directamente con la red f\u00edsica, obteniendo direcciones IP del mismo servidor DHCP que el host o cualquier otro servidor en la red.</li> <li>Flexibilidad: Permite una mayor flexibilidad en la configuraci\u00f3n de redes virtuales, incluyendo la posibilidad de aislar el tr\u00e1fico entre VMs o entre el host y las VMs.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/","title":"03.-Interfaces Virtuales en Linux","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/#31-tipos-comunes-de-interfaces-virtuales","title":"3.1. Tipos Comunes de Interfaces Virtuales","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/#bridge-br0-br1","title":"Bridge (br0, br1, ...)","text":"<ul> <li>Funci\u00f3n: Conecta m\u00faltiples interfaces (f\u00edsicas y virtuales) en una sola red l\u00f3gica.</li> <li>Uso: Principal en virtualizaci\u00f3n para conectar VMs a la red f\u00edsica.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/#taptun-interfaces-tap0-tun0","title":"TAP/TUN Interfaces (tap0, tun0, ...)","text":"<ul> <li>TAP: Interfaz de red virtual que opera en la capa 2 (Ethernet).</li> <li>TUN: Interfaz de red virtual que opera en la capa 3 (IP).</li> <li>Uso: Com\u00fan en configuraciones de VPN y en virtualizaci\u00f3n para crear interfaces de red virtuales.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/#veth-pairs-veth0-veth1","title":"Veth Pairs (veth0, veth1, ...)","text":"<ul> <li>Descripci\u00f3n: Pares de interfaces virtuales conectadas entre s\u00ed, similares a un cable Ethernet.</li> <li>Uso: \u00datiles para conectar namespaces de red o contenedores.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/#vlans-eth010-eth020","title":"VLANs (eth0.10, eth0.20, ...)","text":"<ul> <li>Descripci\u00f3n: Interfaces virtuales que representan VLANs espec\u00edficas en una interfaz f\u00edsica.</li> <li>Uso: Separaci\u00f3n l\u00f3gica de tr\u00e1fico en redes corporativas.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/#32-creacion-y-gestion-de-interfaces-virtuales","title":"3.2. Creaci\u00f3n y Gesti\u00f3n de Interfaces Virtuales","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/#creacion-de-un-bridge-con-ip","title":"Creaci\u00f3n de un Bridge con ip:","text":"<pre><code>sudo ip link add name br0 type bridge\nsudo ip link set dev br0 up\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/#asignacion-de-una-ip-al-bridge","title":"Asignaci\u00f3n de una IP al Bridge:","text":"<pre><code>sudo ip addr add 192.168.1.100/24 dev br0\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/#anadir-una-interfaz-fisica-al-bridge","title":"A\u00f1adir una Interfaz F\u00edsica al Bridge:","text":"<pre><code>sudo ip link set dev enp0s25 master br0\nsudo ip link set dev enp0s25 up\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/03.-Interfaces%20Virtuales%20en%20Linux/#verificar-la-configuracion","title":"Verificar la Configuraci\u00f3n","text":"<pre><code>bridge link\nip addr show br0\n</code></pre> <ul> <li>Uso de NetworkManager (<code>nmcli</code>): NetworkManager simplifica la gesti\u00f3n de interfaces y puentes, permitiendo configuraciones m\u00e1s persistentes y f\u00e1ciles de manejar.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/","title":"04.-Gesti\u00f3n de Puentes con NetworkManager","text":"<p>NetworkManager simplifica la gesti\u00f3n de interfaces y puentes, permitiendo configuraciones m\u00e1s persistentes y f\u00e1ciles de manejar. Dado que vamos a utilizar NetworkManager, es recomendable gestionar los puentes a trav\u00e9s de \u00e9l para asegurar configuraciones persistentes y coherentes.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#verificar-las-conexiones-existentes","title":"Verificar las Conexiones Existentes","text":"<p>Antes de realizar cambios, es recomendable verificar las conexiones actuales y eliminar cualquier configuraci\u00f3n previa que pueda interferir.</p> <pre><code>nmcli connection show\n</code></pre> <p>Si tienes una conexi\u00f3n existente virtual con el interfaz de red, puedes eliminarla:</p> <pre><code>sudo nmcli connection delete &lt;nombre_de_la_conexi\u00f3n&gt;\n</code></pre> <p>Reemplaza  por el nombre real de la conexi\u00f3n asociada al interfaz de red."},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#crear-el-puente-br0","title":"Crear el Puente (br0)","text":"<p>Primero, crearemos la conexi\u00f3n del puente br0:</p> <pre><code>sudo nmcli connection add type bridge ifname br0 con-name br0\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#configurar-la-interfaz-fisica-como-esclava-del-puente","title":"Configurar la Interfaz F\u00edsica como Esclava del Puente","text":"<p>Utilizamos el tipo ethernet y especificamos el puente maestro (<code>master br0</code>).</p> <pre><code>sudo nmcli connection add type ethernet ifname &lt;interfaz f\u00edsica&gt; master br0 con-name &lt;interfaz f\u00edsica&gt;-slave\n</code></pre> <p>Explicaci\u00f3n de los par\u00e1metros:</p> <p><code>type ethernet</code>: Especifica que estamos configurando una conexi\u00f3n Ethernet. <code>ifname &lt;interfaz f\u00edsica&gt;</code>: La interfaz f\u00edsica que deseas agregar al puente (por ejemplo <code>enp3s0</code>). <code>master br0</code>: Define que <code>br0</code> es el puente maestro al que se unir\u00e1 la interfaz f\u00edsica. <code>con-name &lt;interfaz f\u00edsica&gt;-slave</code>: Nombre de la nueva conexi\u00f3n esclava (se puede nombrarla como se prefiera o bien algo as\u00ed <code>enp3s0-slave</code> para distinguirla adecuadamente).</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#configurar-la-asignacion-de-ip-en-el-puente","title":"Configurar la Asignaci\u00f3n de IP en el Puente","text":"<p>Podemos usar DHCP o una IP est\u00e1tica para el puente br0.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#usar-dhcp","title":"Usar DHCP","text":"<p>Si tu red local tiene un servidor DHCP, puedes configurar el puente para obtener una IP autom\u00e1ticamente:</p> <pre><code>sudo nmcli connection modify br0 ipv4.method auto\nsudo nmcli connection modify br0 ipv6.method ignore\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#usar-una-ip-estatica","title":"Usar una IP Est\u00e1tica","text":"<p>Si elegimos asignar una IP est\u00e1tica al puente, utilizaremos los siguientes comandos (ajusta los valores seg\u00fan la configuraci\u00f3n de red):</p> <pre><code>sudo nmcli connection modify br0 ipv4.method manual ipv4.addresses \"172.30.250.32/16\" ipv4.gateway \"172.30.1.1\" ipv4.dns \"172.30.1.1,80.58.61.250,80.58.61.254\" ipv6.method ignore\n</code></pre> <p>Explicaci\u00f3n de los par\u00e1metros:</p> <p><code>ipv4.method manual</code>: Establece una configuraci\u00f3n IP manual. <code>ipv4.addresses</code>: La direcci\u00f3n IP y la m\u00e1scara de red. <code>ipv4.gateway</code>: La puerta de enlace predeterminada. <code>ipv4.dns</code>: Servidores DNS. <code>ipv6.method ignore</code>: Ignora la configuraci\u00f3n IPv6 (ajusta si es necesario).</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#activar-las-conexiones","title":"Activar las Conexiones","text":"<p>Despu\u00e9s de configurar el puente y la interfaz esclava, activa ambas conexiones:</p> <pre><code>sudo nmcli connection up br0\nsudo nmcli connection up enp3s0-slave\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#verificar-la-configuracion-del-puente","title":"Verificar la Configuraci\u00f3n del Puente","text":"<p>Aseg\u00farate de que el puente <code>br0</code> est\u00e1 correctamente configurado y que la interfaz f\u00edsica (<code>enp3s0</code>) est\u00e1 agregada como esclavo:</p> <pre><code>nmcli connection show br0\nnmcli connection show enp3s0-slave\n</code></pre> <p>o bien con:</p> <pre><code>bridge link show br0\n</code></pre> <p>Tambi\u00e9n podemos verificar las interfaces de red:</p> <pre><code>ip addr show br0\nip addr show enp3s0\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#configurar-virt-manager-para-usar-el-puente-br0","title":"Configurar <code>Virt-Manager</code> para usar el Puente <code>br0</code>","text":"<p>Ahora que el puente est\u00e1 configurado, debemos asociar las m\u00e1quinas virtuales para que utilicen br0.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#abrir-virt-manager","title":"Abrir Virt-Manager","text":"<pre><code>    virt-manager\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#editar-la-configuracion-de-la-maquina-virtual","title":"Editar la Configuraci\u00f3n de la M\u00e1quina Virtual","text":"<ul> <li>Seleccionar la VM que deseamos configurar.</li> <li>Hacer clic derecho y seleccionar \"Detalles\".</li> <li>Configurar la Interfaz de Red:</li> <li>En la secci\u00f3n \"NIC\" o \"Interfaz de Red\", cambia el \"Tipo de conexi\u00f3n\" a \"Puente (bridge)\".</li> <li>En el campo \"Nombre del puente\", seleccionamos <code>br0</code>.</li> <li>Guardar los Cambios y Reiniciar la M\u00e1quina Virtual.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#usando-virsh","title":"Usando <code>virsh</code>","text":"<pre><code>virsh attach-interface --domain &lt;nombre_de_vm&gt; --type bridge --source br0 --model virtio --config --live\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#verificar-la-conectividad","title":"Verificar la Conectividad","text":"<p>Desde la M\u00e1quina Virtual: - Nos aseguramos de que la VM obtiene una direcci\u00f3n IP en el mismo rango que la red local (172.30.0.0/16). - Probamos la conectividad haciendo ping al host y a otros dispositivos en la red. - Desde otro dispositivo en la red local intentaremos hacer ping a la direcci\u00f3n IP de la VM para verificar que es accesible.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#configurar-el-firewall-si-es-necesario","title":"Configurar el Firewall (Si es Necesario)","text":"<p>Nos aseguramos de que el firewall en el host y en las VMs permite el tr\u00e1fico necesario. En el Host (si usamos <code>ufw</code>):</p> <pre><code>sudo ufw allow in on br0\n</code></pre> <p>O si usamos <code>firewalld</code> en RHEL/CentOS:</p> <pre><code>sudo firewall-cmd --zone=public --add-interface=br0 --permanent\nsudo firewall-cmd --reload\n</code></pre> <p>En las M\u00e1quinas Virtuales configuramos el firewall dentro de cada VM para permitir el tr\u00e1fico deseado (SSH, HTTP, etc.).</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#solucion-de-problemas","title":"Soluci\u00f3n de Problemas","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#puente-no-funciona","title":"Puente No Funciona","text":"<ul> <li>Verifica que <code>br0</code> est\u00e1 activo y tiene una IP v\u00e1lida:</li> </ul> <pre><code>ip addr show br0\n</code></pre> <ul> <li>Aseg\u00farate de que el interfaz virtual est\u00e1 agregado al puente:</li> </ul> <pre><code>nmcli connection show &lt;interfaz virtual&gt;\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#maquinas-virtuales-no-obtienen-ip","title":"M\u00e1quinas Virtuales No Obtienen IP:","text":"<ul> <li>Aseg\u00farate de que hay un servidor DHCP en tu red o configura una IP est\u00e1tica en la VM.</li> <li>Verifica que el puente <code>br0</code> est\u00e1 correctamente configurado y activo.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#conexion-de-red-perdida","title":"Conexi\u00f3n de Red Perdida:","text":"<ul> <li>Revisar la configuraci\u00f3n de <code>br0</code> y aseg\u00fararse de que no haya conflictos de IP.</li> <li>Verificar los archivos de configuraci\u00f3n y los comandos ejecutados para detectar posibles errores.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/04.-Gesti%C3%B3n%20de%20Puentes%20con%20NetworkManager/#conclusion","title":"Conclusi\u00f3n","text":"<p>Siguiendo estos pasos, deber\u00edamos poder crear un puente de red utilizando <code>nmcli</code> y asociar la interfaz f\u00edsica correctamente. Esto permitir\u00e1 que tus m\u00e1quinas virtuales se integren en la red local y sean accesibles desde otros dispositivos.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/","title":"Flujo de Tr\u00e1fico en un Bridge","text":"<ol> <li> <p>Recepci\u00f3n de Paquetes: Cuando una interfaz (f\u00edsica o virtual) conectada al bridge recibe un paquete, el bridge examina la direcci\u00f3n MAC de destino.</p> </li> <li> <p>Consulta de la Tabla MAC: El bridge consulta su tabla de direcciones MAC para determinar a qu\u00e9 interfaz debe reenviar el paquete.</p> </li> <li>Si la MAC est\u00e1 en la tabla: Reenv\u00eda el paquete \u00fanicamente a la interfaz correspondiente.</li> <li> <p>Si la MAC no est\u00e1 en la tabla: Reenv\u00eda el paquete a todas las interfaces excepto a la de origen (flooding).</p> </li> <li> <p>Aprendizaje de MACs: Al recibir paquetes, el bridge aprende qu\u00e9 MAC est\u00e1 asociada a qu\u00e9 interfaz, actualizando su tabla.</p> </li> </ol>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#interfaces-virtuales-en-el-bridge","title":"Interfaces Virtuales en el Bridge","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#puertas-de-enlace-virtuales","title":"Puertas de Enlace Virtuales","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#definicion","title":"Definici\u00f3n:","text":"<p>Las puertas de enlace virtuales son interfaces de red que, al estar conectadas a un bridge, permiten que las m\u00e1quinas virtuales se comporten como si fueran dispositivos f\u00edsicos dentro de la misma red local. Esto significa que las VMs pueden comunicarse directamente con otros dispositivos en la red, as\u00ed como entre s\u00ed, sin necesidad de NAT (Traducci\u00f3n de Direcciones de Red).</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#detalles-y-funcionamiento","title":"Detalles y Funcionamiento:","text":"<ul> <li>Integraci\u00f3n en la Red Local: Al conectar las VMs a un bridge (br0), estas obtienen direcciones IP del mismo rango que el host y otros dispositivos de la red local, lo que las hace accesibles desde cualquier otro dispositivo en la red.</li> <li>Transparencia de la Red: Las VMs aparecen en la red como si fueran dispositivos f\u00edsicos conectados directamente al switch o router de la red local. Esto facilita el acceso a servicios alojados en las VMs desde otros dispositivos.</li> <li>Configuraci\u00f3n de Puertas de Enlace: Cada VM puede configurarse con una puerta de enlace que apunte al router de la red local (172.30.1.1 en nuestro caso), permiti\u00e9ndoles acceder a Internet y otros recursos externos.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#separacion-de-trafico","title":"Separaci\u00f3n de Tr\u00e1fico","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#definicion_1","title":"Definici\u00f3n:","text":"<p>La separaci\u00f3n de tr\u00e1fico implica gestionar c\u00f3mo fluye el tr\u00e1fico de red entre las diferentes interfaces conectadas al bridge. Aunque todas las interfaces (f\u00edsicas y virtuales) est\u00e1n en el mismo bridge, es posible controlar y aislar el tr\u00e1fico entre ellas utilizando reglas de firewall como <code>iptables</code> o <code>firewalld</code>.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#detalles-y-funcionamiento_1","title":"Detalles y Funcionamiento:","text":"<ul> <li>Mismo Dominio de Broadcast: Todas las interfaces en el bridge comparten el mismo dominio de broadcast, lo que permite que las VMs y el host se vean y se comuniquen directamente entre s\u00ed y con otros dispositivos en la red local. Control de Acceso: Aunque las interfaces est\u00e1n en el mismo bridge, es posible restringir o controlar el tr\u00e1fico entre ellas para mejorar la seguridad y gestionar el flujo de datos. Aislamiento de Tr\u00e1fico: Por ejemplo, puedes querer que ciertas VMs no tengan acceso al host o que el host no pueda acceder a ciertas VMs, pero que las VMs s\u00ed puedan comunicarse entre s\u00ed.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#aislamiento-entre-host-y-puente","title":"Aislamiento entre Host y Puente","text":"<p>Para mejorar la seguridad y el rendimiento, es posible que queramos aislar el host de las m\u00e1quinas virtuales que est\u00e1n conectadas al bridge. Esto implica asegurarse de que el host no participe directamente en el tr\u00e1fico de las VMs y que el tr\u00e1fico entre el host y el bridge est\u00e9 restringido o controlado.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#configuracion-del-bridge-con-networkmanager","title":"Configuraci\u00f3n del Bridge con NetworkManager","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#definicion_2","title":"Definici\u00f3n","text":"<p>Configurar un bridge de red (br0) de manera que el host no tenga una direcci\u00f3n IP asignada al bridge. Esto asegura que el host no participe directamente en el tr\u00e1fico de la red bridged, mejorando la seguridad y reduciendo posibles vectores de ataque.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#pasos-para-configurar-el-bridge-sin-ip-en-el-host-utilizando-networkmanager","title":"Pasos para Configurar el Bridge sin IP en el Host utilizando NetworkManager","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#verificar-el-estado-actual-de-las-conexiones-de-red","title":"Verificar el Estado Actual de las Conexiones de Red","text":"<p>Antes de realizar cualquier cambio, es recomendable revisar las conexiones de red existentes para identificar posibles conflictos.</p> <p>bash</p> <p>nmcli connection show</p> <p>Anota el nombre de la conexi\u00f3n asociada a tu interfaz f\u00edsica (enp3s0 en tu caso).</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#eliminar-configuraciones-previas-opcional","title":"Eliminar Configuraciones Previas (Opcional)","text":"<p>Si la interfaz f\u00edsica enp3s0 ya est\u00e1 configurada con una direcci\u00f3n IP, es recomendable eliminar o modificar esta configuraci\u00f3n para evitar conflictos.</p> <p>bash</p> <p>sudo nmcli connection delete  <p>Reemplaza  con el nombre obtenido en el paso anterior."},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#crear-el-bridge-br0","title":"Crear el Bridge (br0)","text":"<p>Utiliza nmcli para crear una nueva conexi\u00f3n de tipo bridge llamada br0.</p> <p>bash</p> <p>sudo nmcli connection add type bridge ifname br0 con-name br0</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#configurar-el-bridge-br0-sin-asignarle-una-direccion-ip","title":"Configurar el Bridge (br0) sin Asignarle una Direcci\u00f3n IP","text":"<p>Modifica la configuraci\u00f3n del bridge para que no obtenga una direcci\u00f3n IP autom\u00e1ticamente (no use DHCP ni tenga una IP est\u00e1tica).</p> <p>bash</p> <p>sudo nmcli connection modify br0 ipv4.method disabled ipv6.method ignore</p> <p>Explicaci\u00f3n de los Par\u00e1metros:</p> <pre><code>ipv4.method disabled: Desactiva la asignaci\u00f3n autom\u00e1tica de direcciones IPv4.\nipv6.method ignore: Ignora la configuraci\u00f3n de IPv6.\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#asociar-la-interfaz-fisica-enp3s0-al-bridge-br0","title":"Asociar la Interfaz F\u00edsica (enp3s0) al Bridge (br0)","text":"<p>En lugar de usar el tipo bridge-slave, configura la interfaz f\u00edsica como una esclava del bridge utilizando el par\u00e1metro master.</p> <pre><code>\nsudo nmcli connection add type ethernet ifname enp3s0 master br0 con-name enp3s0-slave\n</code></pre> <p>Explicaci\u00f3n de los Par\u00e1metros: type ethernet: Especifica que estamos configurando una conexi\u00f3n Ethernet. ifname enp3s0: La interfaz f\u00edsica que deseas agregar al bridge. master br0: Define que br0 es el bridge maestro al que se unir\u00e1 enp3s0. con-name enp3s0-slave: Nombre de la nueva conexi\u00f3n esclava (puedes nombrarlo como prefieras).</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#desactivar-la-asignacion-de-ip-a-la-interfaz-fisica-enp3s0","title":"Desactivar la Asignaci\u00f3n de IP a la Interfaz F\u00edsica (enp3s0)","text":"<p>Aseg\u00farate de que la interfaz f\u00edsica no tenga una direcci\u00f3n IP asignada directamente, ya que el bridge ser\u00e1 el \u00fanico punto de configuraci\u00f3n de red.</p> <p>bash</p> <p>sudo nmcli connection modify enp3s0-slave ipv4.method disabled ipv6.method ignore</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#activar-las-conexiones","title":"Activar las Conexiones","text":"<p>Despu\u00e9s de configurar el bridge y la interfaz esclava, activa ambas conexiones para aplicar los cambios.</p> <p>bash</p> <p>sudo nmcli connection up br0 sudo nmcli connection up enp3s0-slave</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#verificar-la-configuracion-del-bridge","title":"Verificar la Configuraci\u00f3n del Bridge","text":"<p>Confirma que el bridge br0 est\u00e1 activo y que enp3s0 est\u00e1 correctamente asociado como esclava.</p> <p>``bash</p> <p>nmcli connection show br0 nmcli connection show enp3s0-slave `` Tambi\u00e9n puedes verificar las interfaces de red:</p> <p><code>bash ip addr show br0 ip addr show enp3s0</code> Resultado Esperado: - br0 no debe tener una direcci\u00f3n IP asignada. - enp3s0 debe estar asociada al bridge br0 y no tener una direcci\u00f3n IP propia.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#eliminar-la-direccion-ip-del-bridge-si-ya-esta-asignada","title":"Eliminar la Direcci\u00f3n IP del Bridge (si ya est\u00e1 Asignada)","text":"<p>Si anteriormente el bridge br0 ten\u00eda una direcci\u00f3n IP asignada, puedes eliminarla temporalmente para verificar el aislamiento.</p> <pre><code>sudo ip addr flush dev br0\n</code></pre> <p>Nota: Este cambio es temporal y se revertir\u00e1 despu\u00e9s de reiniciar el sistema o volver a activar la conexi\u00f3n.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#configurar-el-host-para-utilizar-la-interfaz-fisica-directamente-opcional","title":"Configurar el Host para Utilizar la Interfaz F\u00edsica Directamente (Opcional)","text":"<p>Si deseas que el host mantenga su conectividad de red sin depender del bridge, puedes asignar una direcci\u00f3n IP directamente a enp3s0. Sin embargo, esto podr\u00eda interferir con la funcionalidad del bridge y no se recomienda si deseas un aislamiento efectivo. Es recomendable mantener la configuraci\u00f3n del bridge sin una IP asignada al host.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#ejemplo-de-asignacion-de-ip-estatica-directamente-a-enp3s0-no-recomendado-para-aislamiento","title":"Ejemplo de Asignaci\u00f3n de IP Est\u00e1tica Directamente a enp3s0 (No Recomendado para Aislamiento):","text":"<pre><code>sudo nmcli connection modify enp3s0-slave ipv4.method manual ipv4.addresses \"172.30.250.32/16\" ipv4.gateway \"172.30.1.1\" ipv4.dns \"172.30.1.1,80.58.61.250,80.58.61.254\"\nsudo nmcli connection up enp3s0-slave\n</code></pre> <ul> <li>Recomendaci\u00f3n: Para mantener el aislamiento entre el host y las m\u00e1quinas virtuales, no asignes una direcci\u00f3n IP directamente a enp3s0. En su lugar, gestiona las direcciones IP desde las m\u00e1quinas virtuales a trav\u00e9s del bridge br0.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#configuracion-de-las-maquinas-virtuales-para-usar-el-bridge-br0","title":"Configuraci\u00f3n de las M\u00e1quinas Virtuales para Usar el Bridge (br0)","text":"<p>Una vez que el bridge br0 est\u00e1 configurado sin una direcci\u00f3n IP en el host, debes configurar tus m\u00e1quinas virtuales para que utilicen este bridge. A continuaci\u00f3n, se describen los pasos para hacerlo utilizando Virt-Manager.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#abrir-virt-manager","title":"Abrir Virt-Manager","text":"<p>Inicia Virt-Manager desde la terminal o desde el men\u00fa de aplicaciones.</p> <p>bash</p> <p>virt-manager</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#editar-la-configuracion-de-la-maquina-virtual","title":"Editar la Configuraci\u00f3n de la M\u00e1quina Virtual","text":"<pre><code>Selecciona la M\u00e1quina Virtual:\n    En la lista de m\u00e1quinas virtuales, selecciona la VM que deseas configurar.\nAccede a los Detalles:\n    Haz clic derecho sobre la VM seleccionada y elige \"Detalles\".\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#configurar-la-interfaz-de-red-para-usar-el-bridge-br0","title":"Configurar la Interfaz de Red para Usar el Bridge (br0)","text":"<pre><code>Acceder a la Secci\u00f3n de NIC:\n    En la ventana de detalles, selecciona \"NIC\" o \"Interfaz de Red\" en el panel izquierdo.\n\nCambiar el Tipo de Conexi\u00f3n a Bridge:\n    En el campo \"Tipo de Conexi\u00f3n\", selecciona \"Bridge\".\n\nSeleccionar el Nombre del Bridge:\n    En el campo \"Nombre del Bridge\", selecciona br0 de la lista desplegable.\n\nAplicar los Cambios:\n    Haz clic en \"Aplicar\" o \"OK\" para guardar los cambios.\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#reiniciar-la-maquina-virtual","title":"Reiniciar la M\u00e1quina Virtual","text":"<p>Reinicia la VM para que aplique la nueva configuraci\u00f3n de red a trav\u00e9s del bridge.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#verificacion-de-la-configuracion","title":"Verificaci\u00f3n de la Configuraci\u00f3n","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#desde-el-host","title":"Desde el Host","text":"<ul> <li>Verificar que el Bridge no tiene una IP:</li> </ul> <pre><code>ip addr show br0\n</code></pre> <p>Resultado Esperado: No debe mostrar una direcci\u00f3n IP asignada a br0.</p> <ul> <li>Verificar que enp3s0 est\u00e1 Asociada al Bridge:</li> </ul> <pre><code>nmcli connection show enp3s0-slave\n</code></pre> <p>Resultado Esperado: La conexi\u00f3n enp3s0-slave debe estar configurada como esclava del bridge br0.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#desde-las-maquinas-virtuales","title":"Desde las M\u00e1quinas Virtuales","text":"<ul> <li>Obtener una Direcci\u00f3n IP: Aseg\u00farate de que las VMs obtienen una direcci\u00f3n IP en el mismo rango que tu red local (por DHCP desde el router).</li> </ul> <pre><code>ip addr show &lt;interfaz_de_red&gt;\n</code></pre> <p>Ejemplo:</p> <pre><code>ip addr show enp0s3\n</code></pre> <p>Probar la Conectividad:</p> <p>Desde la VM, intenta hacer ping al router y a otros dispositivos en la red local.</p> <pre><code>ping 172.30.1.1\nping &lt;otra_direcci\u00f3n_IP_en_la_red&gt;\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#desde-otros-dispositivos-en-la-red-local","title":"Desde Otros Dispositivos en la Red Local","text":"<ul> <li>Acceder a las VMs: Intenta hacer ping a la direcci\u00f3n IP asignada a cada VM desde otros dispositivos en la red.</li> </ul> <pre><code>ping 172.30.250.x\n</code></pre> <ul> <li>Accede a servicios alojados en las VMs, como SSH o servidores web, utilizando sus direcciones IP.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#aislamiento-entre-host-y-puente_1","title":"Aislamiento entre Host y Puente","text":"<p>Para aislar el host de las m\u00e1quinas virtuales en el bridge br0, es necesario implementar reglas de firewall que controlen el tr\u00e1fico entre el host y las VMs. A continuaci\u00f3n, se detallan los pasos utilizando iptables y firewalld.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#utilizar-iptables-para-controlar-el-trafico","title":"Utilizar iptables para Controlar el Tr\u00e1fico","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#bloquear-todo-el-trafico-entrante-desde-el-bridge-al-host","title":"Bloquear Todo el Tr\u00e1fico Entrante desde el Bridge al Host:","text":"<p>Esto evita que las VMs puedan acceder directamente al host a trav\u00e9s del bridge.</p> <p>bash</p> <p>sudo iptables -A INPUT -i br0 -j DROP</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#permitir-trafico-saliente-desde-el-host-al-bridge-opcional","title":"Permitir Tr\u00e1fico Saliente desde el Host al Bridge (Opcional):","text":"<p>Si deseas que el host pueda enviar tr\u00e1fico al bridge pero no recibir, puedes permitir el tr\u00e1fico saliente.</p> <p>bash</p> <p>sudo iptables -A OUTPUT -o br0 -j ACCEPT</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#permitir-trafico-especifico-por-ejemplo-ssh","title":"Permitir Tr\u00e1fico Espec\u00edfico (Por Ejemplo, SSH):","text":"<p>Si necesitas permitir ciertos tipos de tr\u00e1fico desde las VMs al host, como SSH, agrega reglas espec\u00edficas antes de la regla de bloqueo general.</p> <p>bash</p> <p>sudo iptables -I INPUT -i br0 -p tcp --dport 22 -j ACCEPT</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#guardar-las-reglas-de-iptables","title":"Guardar las Reglas de iptables:","text":"<p>Para que las reglas persistan despu\u00e9s de reiniciar, es necesario guardarlas.</p> <p>En Debian/Ubuntu:</p> <pre><code>sudo apt install iptables-persistent\nsudo netfilter-persistent save\n</code></pre> <p>En Otras Distribuciones: Utiliza el m\u00e9todo correspondiente para guardar las reglas de iptables, como scripts de inicio o herramientas espec\u00edficas de la distribuci\u00f3n.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#utilizar-firewalld-para-gestionar-el-firewall","title":"Utilizar firewalld para Gestionar el Firewall","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#asignar-el-bridge-a-una-zona-especifica","title":"Asignar el Bridge a una Zona Espec\u00edfica:","text":"<p>Por ejemplo, asignar br0 a la zona internal.</p> <p>bash</p> <p>sudo firewall-cmd --permanent --zone=internal --add-interface=br0</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#definir-reglas-para-la-zona-internal","title":"Definir Reglas para la Zona internal:","text":"<p>Bloquear Todo el Tr\u00e1fico Entrante desde el Bridge al Host:</p> <pre><code>sudo firewall-cmd --permanent --zone=internal --add-rich-rule='rule family=\"ipv4\" source address=\"172.30.250.0/16\" reject'\n</code></pre> <p>Permitir Tr\u00e1fico Espec\u00edfico (Por Ejemplo, SSH):</p> <pre><code>sudo firewall-cmd --permanent --zone=internal --add-service=ssh\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#recargar-firewalld-para-aplicar-cambios","title":"Recargar firewalld para Aplicar Cambios:","text":"<pre><code>sudo firewall-cmd --reload\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#verificar-las-reglas-del-firewall","title":"Verificar las Reglas del Firewall","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#para-iptables","title":"Para iptables:","text":"<pre><code>\nsudo iptables -L -v\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#para-firewalld","title":"Para firewalld:","text":"<pre><code>\nsudo firewall-cmd --list-all --zone=internal\n</code></pre> <p>Resultado Esperado: Las reglas deber\u00edan reflejar el bloqueo general del tr\u00e1fico desde el bridge al host, con excepciones para servicios espec\u00edficos como SSH si se han definido.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#consideraciones-adicionales","title":"Consideraciones Adicionales","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#seguridad-del-firewall","title":"Seguridad del Firewall","text":"<p>Prioridad de Reglas: Aseg\u00farate de que las reglas espec\u00edficas (como permitir SSH) se agreguen antes de las reglas generales de bloqueo para que no sean sobrescritas.</p> <p>Revisi\u00f3n Regular: Revisa peri\u00f3dicamente las reglas de firewall para asegurarte de que siguen cumpliendo con los requisitos de seguridad y funcionalidad.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#documentacion-y-backups","title":"Documentaci\u00f3n y Backups","text":"<p>Documenta tus Configuraciones: Mant\u00e9n un registro de las configuraciones realizadas para facilitar futuras modificaciones o resoluciones de problemas.</p> <p>Realiza Backups: Antes de realizar cambios significativos en la configuraci\u00f3n de red o firewall, realiza backups de los archivos de configuraci\u00f3n y reglas actuales.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#monitoreo-de-la-red","title":"Monitoreo de la Red","text":"<p>Utiliza Herramientas de Monitoreo: Implementa herramientas como Wireshark, tcpdump, o nmap para supervisar y analizar el tr\u00e1fico de red, lo que te ayudar\u00e1 a detectar actividades inusuales o problemas de configuraci\u00f3n.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#actualizaciones-y-parches","title":"Actualizaciones y Parches","text":"<p>Mant\u00e9n tu Sistema Actualizado: Aseg\u00farate de que tu sistema operativo y todas las herramientas de red est\u00e1n actualizadas para beneficiarte de mejoras de seguridad y funcionalidad.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#resumen","title":"Resumen","text":"<p>Al seguir estos pasos, habr\u00e1s configurado un bridge de red (br0) utilizando NetworkManager en Linux, asegur\u00e1ndote de que el host no tenga una direcci\u00f3n IP asignada al bridge. Esto logra dos objetivos principales:</p> <p>Integraci\u00f3n de M\u00e1quinas Virtuales en la Red Local: Las VMs pueden comunicarse directamente con otros dispositivos en la red local como si fueran dispositivos f\u00edsicos adicionales.</p> <p>Aislamiento y Seguridad del Host: El host no participa directamente en el tr\u00e1fico del bridge, reduciendo la superficie de ataque y mejorando la seguridad mediante el uso de reglas de firewall para controlar el tr\u00e1fico entre el bridge y el host.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#pasos-clave-realizados","title":"Pasos Clave Realizados:","text":"<p>Creaci\u00f3n y Configuraci\u00f3n del Bridge (br0): Creaste un bridge sin asignarle una direcci\u00f3n IP, asegurando que el host no participa directamente en el tr\u00e1fico del bridge.</p> <p>Asociaci\u00f3n de la Interfaz F\u00edsica (enp3s0) al Bridge: Configuraste la interfaz f\u00edsica como esclava del bridge, permitiendo que las VMs conectadas al bridge obtengan direcciones IP de la red local.</p> <p>Configuraci\u00f3n de las M\u00e1quinas Virtuales: Configuraste las VMs para que utilicen el bridge br0 como su interfaz de red, permitiendo su integraci\u00f3n en la red local.</p> <p>Implementaci\u00f3n de Reglas de Firewall: Utilizaste iptables o firewalld para controlar y aislar el tr\u00e1fico entre el bridge y el host, mejorando la seguridad.</p> <p>Verificaci\u00f3n de la Configuraci\u00f3n: Confirmaste que el bridge no tiene una direcci\u00f3n IP en el host y que las VMs pueden comunicarse adecuadamente dentro de la red local.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/05.-Funcionamiento%20Interno%20de%20los%20Puentes%20e%20Interfaces%20Virtuales/#beneficios-de-esta-configuracion","title":"Beneficios de Esta Configuraci\u00f3n:","text":"<p>Seguridad Mejorada: Al aislar el host del tr\u00e1fico del bridge, reduces el riesgo de que las VMs comprometan la seguridad del host.     Accesibilidad Directa de las VMs: Las VMs son tratadas como dispositivos f\u00edsicos en la red, facilitando el acceso desde otros dispositivos.     Control Granular del Tr\u00e1fico: Las reglas de firewall permiten un control preciso sobre qu\u00e9 tipo de tr\u00e1fico est\u00e1 permitido entre el host y las VMs.</p> <p>Soluci\u00f3n de Problemas Comunes 1. Las VMs No Obtienen una Direcci\u00f3n IP</p> <pre><code>Verificar la Configuraci\u00f3n del Bridge:\n    Aseg\u00farate de que br0 est\u00e1 correctamente configurado y activo sin una direcci\u00f3n IP asignada.\n\nComprobar el Servidor DHCP:\n    Verifica que el servidor DHCP (generalmente tu router) est\u00e1 funcionando correctamente y tiene un rango de direcciones IP disponible.\n\nReiniciar el Servicio de Red en las VMs:\n    En las VMs, reinicia el servicio de red para forzar la obtenci\u00f3n de una nueva direcci\u00f3n IP.\n\nbash\n\nsudo systemctl restart NetworkManager\n# o\nsudo dhclient -r &amp;&amp; sudo dhclient\n</code></pre> <ol> <li> <p>Las VMs No Son Accesibles Desde Otros Dispositivos en la Red Local</p> <p>Revisar Reglas de Firewall:     Aseg\u00farate de que las reglas de firewall en el host y en las VMs no est\u00e1n bloqueando el tr\u00e1fico necesario.</p> <p>Verificar la Configuraci\u00f3n de Red en las VMs:     Confirma que las VMs tienen configurada correctamente la puerta de enlace (gateway) y los servidores DNS.</p> <p>Probar la Conectividad de Red:     Desde otro dispositivo en la red local, intenta hacer ping a la direcci\u00f3n IP de la VM.</p> <p>bash</p> <p>ping 172.30.250.x</p> </li> <li> <p>El Host Pierde Conectividad de Red</p> <p>Revisar la Configuraci\u00f3n del Bridge:     Aseg\u00farate de que el bridge br0 no tiene una direcci\u00f3n IP asignada y que enp3s0 est\u00e1 correctamente asociada como esclava.</p> <p>Verificar Reglas de Firewall:     Revisa que las reglas de firewall no est\u00e1n bloqueando el tr\u00e1fico necesario para la conectividad del host.</p> <p>Reiniciar NetworkManager:     Reinicia el servicio de NetworkManager para aplicar nuevamente las configuraciones.</p> <p>bash</p> <p>sudo systemctl restart NetworkManager</p> </li> <li> <p>Problemas al Crear el Bridge con nmcli</p> <p>Errores en los Comandos de nmcli:     Aseg\u00farate de que est\u00e1s utilizando la sintaxis correcta al crear y modificar las conexiones.</p> <p>Verificar el Estado de las Conexiones:     Usa nmcli para comprobar que las conexiones est\u00e1n activas y correctamente configuradas.</p> <p>bash</p> <p>nmcli connection show --active</p> </li> <li> <p>Conflictos de Direcciones IP</p> <p>Asignar Direcciones IP Est\u00e1ticas a las VMs:     Si hay problemas con el DHCP, considera asignar direcciones IP est\u00e1ticas a las VMs dentro del rango de tu red local.</p> <p>Evitar Duplicados:     Aseg\u00farate de que no hay direcciones IP duplicadas en la red, lo que puede causar conflictos de conectividad.</p> </li> </ol> <p>Conclusi\u00f3n</p> <p>Configurar un bridge de red (br0) utilizando NetworkManager en Linux y asegurarse de que el host no tiene una direcci\u00f3n IP asignada al bridge es una pr\u00e1ctica efectiva para integrar m\u00e1quinas virtuales en la red local mientras se mantiene el aislamiento y la seguridad del host. Esta configuraci\u00f3n permite que las VMs sean accesibles desde otros dispositivos en la red local como si fueran dispositivos f\u00edsicos adicionales, al tiempo que limita la interacci\u00f3n directa entre las VMs y el host mediante reglas de firewall.</p> <p>Beneficios Clave:</p> <pre><code>Seguridad Mejorada: Aislamiento del host del tr\u00e1fico del bridge.\nAccesibilidad Directa: Las VMs son tratadas como dispositivos f\u00edsicos en la red local.\nControl Granular: Reglas de firewall permiten gestionar el tr\u00e1fico entre el host y las VMs.\n</code></pre> <p>Recomendaciones Finales:</p> <pre><code>Mant\u00e9n Documentadas las Configuraciones: Facilita futuras modificaciones y resoluciones de problemas.\nMonitorea Regularmente la Red: Utiliza herramientas de monitoreo para asegurar que la configuraci\u00f3n est\u00e1 funcionando seg\u00fan lo esperado.\nActualiza Regularmente el Sistema y las Herramientas de Red: Benef\u00edciate de mejoras de seguridad y funcionalidad.\n</code></pre> <p>Si encuentras dificultades espec\u00edficas durante la configuraci\u00f3n o tienes preguntas adicionales, no dudes en consultarme para recibir asistencia m\u00e1s detallada.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/06.-Gesti%C3%B3n%20Avanzada%20de%20Puentes%20e%20Interfaces%20Virtuales/","title":"06.-Gesti\u00f3n Avanzada de Puentes e Interfaces Virtuales","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/06.-Gesti%C3%B3n%20Avanzada%20de%20Puentes%20e%20Interfaces%20Virtuales/#61-vlans-y-puentes","title":"6.1. VLANs y Puentes","text":"<ul> <li>VLANs: Los puentes pueden manejar VLANs para segmentar el tr\u00e1fico. Esto se hace creando interfaces VLAN y agreg\u00e1ndolas al bridge.</li> <li>Configuraci\u00f3n: A\u00f1adir interfaces VLAN (<code>eth0.10</code>, <code>eth0.20</code>, ...) y conectarlas al bridge para separar el tr\u00e1fico seg\u00fan las VLANs.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/06.-Gesti%C3%B3n%20Avanzada%20de%20Puentes%20e%20Interfaces%20Virtuales/#62-bonding-y-agregacion-de-enlaces","title":"6.2. Bonding y Agregaci\u00f3n de Enlaces","text":"<ul> <li>Bonding: Combina m\u00faltiples interfaces f\u00edsicas en una sola interfaz l\u00f3gica para redundancia o aumento de ancho de banda.</li> <li>Uso con Bridges: Los enlaces bond pueden ser agregados a un bridge para proporcionar una conexi\u00f3n m\u00e1s robusta a las m\u00e1quinas virtuales.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/06.-Gesti%C3%B3n%20Avanzada%20de%20Puentes%20e%20Interfaces%20Virtuales/#63-interfaces-tap-y-qemukvm","title":"6.3. Interfaces Tap y QEMU/KVM","text":"<ul> <li>Tap Interfaces1: Son interfaces virtuales que permiten que QEMU/KVM interact\u00fae directamente con el puente.</li> <li>Uso: Al iniciar una VM con QEMU/KVM, se puede especificar el uso de una interfaz tap para conectarse al bridge, permitiendo que la VM se comunique directamente con la red.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/","title":"07.-Herramientas y comandos \u00fatiles","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#71-comandos-ip-y-bridge","title":"7.1. Comandos <code>ip</code> y <code>bridge</code>","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#crear-un-bridge","title":"Crear un Bridge","text":"<pre><code>sudo ip link add name br0 type bridge\nsudo ip link set dev br0 up\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#anadir-una-interfaz-al-bridge","title":"A\u00f1adir una Interfaz al Bridge","text":"<pre><code>sudo ip link set dev enp0s25 master br0\nsudo ip link set dev enp0s25 up\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#mostrar-configuracion-del-bridge","title":"Mostrar Configuraci\u00f3n del Bridge","text":"<pre><code>bridge link show br0\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#72-nmcli-networkmanager-command-line","title":"7.2. nmcli (NetworkManager Command Line)","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#listar-conexiones","title":"Listar Conexiones","text":"<pre><code>nmcli connection show\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#crear-un-bridge_1","title":"Crear un Bridge","text":"<pre><code>nmcli connection add type bridge autoconnect yes con-name br0 ifname br0\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#agregar-una-interface-fisica-al-bridge","title":"Agregar una Interface F\u00edsica al Bridge","text":"<pre><code>nmcli connection add type bridge-slave autoconnect yes con-name enp0s25-slave ifname enp0s25 master br0\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#modificar-la-configuracion-del-bridge","title":"Modificar la Configuraci\u00f3n del Bridge","text":"<pre><code>nmcli connection modify br0 ipv4.method auto\nnmcli connection modify br0 ipv6.method ignore\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#activar-una-conexion","title":"Activar una Conexi\u00f3n","text":"<pre><code>nmcli connection up br0\nnmcli connection up enp0s25-slave\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#73-bridge-utils","title":"7.3. bridge-utils","text":"<p>Aunque muchas funcionalidades est\u00e1n ahora integradas en el comando <code>ip</code>, <code>bridge-utils</code> sigue siendo \u00fatil para algunas operaciones.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#instalacion","title":"Instalaci\u00f3n","text":"<pre><code>sudo pacman -S bridge-utils\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#mostrar-informacion-del-bridge","title":"Mostrar Informaci\u00f3n del Bridge","text":"<pre><code>brctl show\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/07.-Herramientas%20y%20comandos%20%C3%BAtiles/#anadir-una-interfaz-al-bridge_1","title":"A\u00f1adir una Interfaz al Bridge","text":"<pre><code>sudo brctl addif br0 enp0s25\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/08.-Consideraciones%20de%20Seguridad/","title":"08.-Consideraciones de Seguridad","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/08.-Consideraciones%20de%20Seguridad/#81-aislamiento-del-host","title":"8.1. Aislamiento del Host","text":"<p>Para evitar que el host interact\u00fae con las VMs a trav\u00e9s del bridge:</p> <ul> <li>No Asignar IP al Bridge: Si el host no necesita comunicarse en esa red, no le asignes una direcci\u00f3n IP al bridge.</li> <li>Reglas de Firewall: Utiliza <code>iptables</code> o <code>firewalld</code> para bloquear el tr\u00e1fico entre el host y las interfaces del bridge.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/08.-Consideraciones%20de%20Seguridad/#82-filtrado-de-macs","title":"8.2. Filtrado de MACs","text":"<ul> <li>Control de Acceso: Configura reglas para permitir solo ciertas direcciones MAC en el bridge, limitando qu\u00e9 dispositivos pueden conectarse.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/08.-Consideraciones%20de%20Seguridad/#83-monitoreo-y-logging","title":"8.3. Monitoreo y Logging","text":"<ul> <li>Supervisi\u00f3n del Tr\u00e1fico: Utiliza herramientas como <code>tcpdump</code>, <code>wireshark</code> o <code>iftop</code> para monitorear el tr\u00e1fico en el bridge.</li> <li>Logs de NetworkManager: Revisa los logs de NetworkManager para solucionar problemas de configuraci\u00f3n.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/09.-Ejemplo%20Pr%C3%A1ctico%3AConfiguraci%C3%B3n%20Completa%20con%20NetworkManager/","title":"09.-Ejemplo Pr\u00e1ctico:Configuraci\u00f3n Completa con NetworkManager","text":"<p>Supongamos que deseas configurar un bridge <code>br0</code> que conecta tus VMs directamente a la red f\u00edsica, permitiendo que obtengan direcciones IP de un servidor DHCP externo, y deseas aislar el host de esta red.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/09.-Ejemplo%20Pr%C3%A1ctico%3AConfiguraci%C3%B3n%20Completa%20con%20NetworkManager/#paso-1-crear-el-bridge-br0","title":"Paso 1: Crear el Bridge <code>br0</code>","text":"<pre><code># Crear el bridge\nnmcli connection add type bridge autoconnect yes con-name br0 ifname br0\n\n# Agregar la interfaz f\u00edsica al bridge\nnmcli connection add type bridge-slave autoconnect yes con-name enp0s25-slave ifname enp0s25 master br0\n\n# Configurar el bridge para obtener IP v\u00eda DHCP\nnmcli connection modify br0 ipv4.method auto\nnmcli connection modify br0 ipv6.method ignore\n\n# Desactivar la asignaci\u00f3n de IP en la interfaz f\u00edsica (ya manejado por bridge-slave)\n\n# Activar las conexiones\nnmcli connection up br0\nnmcli connection up enp0s25-slave\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/09.-Ejemplo%20Pr%C3%A1ctico%3AConfiguraci%C3%B3n%20Completa%20con%20NetworkManager/#paso-2-conectar-las-vms-al-bridge","title":"Paso 2: Conectar las VMs al Bridge","text":"<p>Usando <code>virsh</code>:</p> <pre><code># Apagar la VM si est\u00e1 en ejecuci\u00f3n\nvirsh shutdown &lt;nombre_de_vm&gt;\n\n# Editar la configuraci\u00f3n de la VM\nvirsh edit &lt;nombre_de_vm&gt;\n\nEn el archivo XML de la VM, modifica la secci\u00f3n &lt;interface&gt;:\n\nxml\n\n&lt;interface type='bridge'&gt;\n  &lt;mac address='52:54:00:xx:xx:xx'/&gt;\n  &lt;source bridge='br0'/&gt;\n  &lt;model type='virtio'/&gt;\n  &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;\n&lt;/interface&gt;\n</code></pre> <p>Guardar y cerrar el editor, luego iniciar la VM:</p> <pre><code>virsh start &lt;nombre_de_vm&gt;\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/09.-Ejemplo%20Pr%C3%A1ctico%3AConfiguraci%C3%B3n%20Completa%20con%20NetworkManager/#paso-3-aislar-el-host-del-bridge","title":"Paso 3: Aislar el Host del Bridge","text":"<p>Implementar reglas de iptables para bloquear el tr\u00e1fico entre el host y el bridge br0:</p> <pre><code># Bloquear tr\u00e1fico entrante desde br0 hacia el host\nsudo iptables -A INPUT -i br0 -j DROP\n\n# Bloquear tr\u00e1fico saliente desde el host hacia br0\nsudo iptables -A OUTPUT -o br0 -j DROP\n\n# Guardar las reglas para que persistan tras reinicios\nsudo iptables-save | sudo tee /etc/iptables/iptables.rules\n\n# Habilitar el servicio de iptables para restaurar las reglas al inicio\nsudo systemctl enable iptables\nsudo systemctl start iptables\n</code></pre>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/09.-Ejemplo%20Pr%C3%A1ctico%3AConfiguraci%C3%B3n%20Completa%20con%20NetworkManager/#paso-4-verificacion","title":"Paso 4: Verificaci\u00f3n","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/09.-Ejemplo%20Pr%C3%A1ctico%3AConfiguraci%C3%B3n%20Completa%20con%20NetworkManager/#verificar-direccion-ip-del-bridge","title":"Verificar Direcci\u00f3n IP del Bridge:","text":"<pre><code>ip addr show br0\n</code></pre> <p>Deber\u00edamos ver una direcci\u00f3n IP asignada por el servidor DHCP externo.</p>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/09.-Ejemplo%20Pr%C3%A1ctico%3AConfiguraci%C3%B3n%20Completa%20con%20NetworkManager/#verificar-conectividad-de-la-vm","title":"Verificar Conectividad de la VM:","text":"<ul> <li>Inicia la VM y verifica que obtiene una direcci\u00f3n IP del mismo servidor DHCP.</li> <li>Comprueba que la VM puede acceder a Internet y otros recursos de la red.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/09.-Ejemplo%20Pr%C3%A1ctico%3AConfiguraci%C3%B3n%20Completa%20con%20NetworkManager/#verificar-aislamiento-del-host","title":"Verificar Aislamiento del Host:","text":"<ul> <li>Desde el host, intentamos hacer ping a la direcci\u00f3n IP de la VM. Deber\u00eda fallar.</li> <li>Desde la VM, intentamos hacer ping al host. Deber\u00eda fallar.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/10.-Resumen%20y%20Mejores%20Pr%C3%A1cticas/","title":"10.-Resumen y Mejores Pr\u00e1cticas","text":""},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/10.-Resumen%20y%20Mejores%20Pr%C3%A1cticas/#101-puentes-de-red","title":"10.1. Puentes de Red","text":"<ul> <li>Flexibilidad: Permiten que m\u00faltiples interfaces (f\u00edsicas y virtuales) se comuniquen como si estuvieran en la misma red f\u00edsica.</li> <li>Virtualizaci\u00f3n: Esencial para conectar VMs directamente a la red f\u00edsica, facilitando la asignaci\u00f3n de direcciones IP y la comunicaci\u00f3n con otros dispositivos de la red.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/10.-Resumen%20y%20Mejores%20Pr%C3%A1cticas/#102-interfaces-virtuales","title":"10.2. Interfaces Virtuales","text":"<ul> <li>Versatilidad: Utilizadas para una variedad de prop\u00f3sitos, desde VPNs hasta conexiones de VMs y contenedores.</li> <li>Aislamiento y Seguridad: Permiten segmentar y controlar el tr\u00e1fico de manera granular.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/10.-Resumen%20y%20Mejores%20Pr%C3%A1cticas/#103-gestion-con-networkmanager","title":"10.3. Gesti\u00f3n con NetworkManager","text":"<ul> <li>Persistencia: Las configuraciones realizadas con NetworkManager son persistentes y se aplican autom\u00e1ticamente al reiniciar.</li> <li>Facilidad de Uso: Herramientas como <code>nmcli</code> y <code>nmtui</code> simplifican la gesti\u00f3n de redes complejas.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/10.-Resumen%20y%20Mejores%20Pr%C3%A1cticas/#104-seguridad","title":"10.4. Seguridad","text":"<ul> <li>Aislamiento del Host: Siempre que sea necesario, utiliza reglas de firewall para limitar o bloquear la comunicaci\u00f3n entre el host y las interfaces virtuales.</li> <li>Control de Acceso: Implementa medidas como filtrado de MACs o VLANs para controlar qui\u00e9n puede acceder a qu\u00e9 recursos.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/10.-Resumen%20y%20Mejores%20Pr%C3%A1cticas/#105-monitoreo-y-mantenimiento","title":"10.5. Monitoreo y Mantenimiento","text":"<ul> <li>Monitoreo Continuo: Utiliza herramientas de monitoreo para mantener un ojo en el tr\u00e1fico y detectar posibles anomal\u00edas.</li> <li>Actualizaciones y Parches: Mant\u00e9n tus herramientas de red y sistemas actualizados para garantizar la seguridad y el rendimiento.</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/11.-Recursos%20adicionales/","title":"11.-Recursos adicionales","text":"<ul> <li>Documentaci\u00f3n de NetworkManager: https://developer.gnome.org/NetworkManager/stable/</li> <li>Manuales de nmcli:</li> </ul> <pre><code>        man nmcli\n</code></pre> <ul> <li>Documentaci\u00f3n de KVM/QEMU Networking: https://wiki.qemu.org/Documentation/Networking</li> <li>Tutoriales de Bridge Networking en Arch Linux: Arch Wiki - Bridge</li> </ul>"},{"location":"01.-KVM/01.-Red/02.-Puentes%20e%20Interfaces%20Virtuales/Testeo%20de%20DHCP/","title":"Testeo de DHCP","text":"<p>Para identificar qu\u00e9 dispositivo o servicio ha asignado una direcci\u00f3n IP a un dispositivo en tu red local, puedes seguir varios m\u00e9todos. A continuaci\u00f3n, se detallan diferentes enfoques que te ayudar\u00e1n a determinar la fuente de asignaci\u00f3n de IP, ya sea un servidor DHCP dedicado, tu router, o alg\u00fan otro dispositivo en la red. 1. Verificar la Configuraci\u00f3n de Red del Dispositivo</p> <p>a. En Linux:</p> <p>Puedes utilizar el comando nmcli o ip para obtener detalles sobre la configuraci\u00f3n de red, incluyendo el servidor DHCP que ha asignado la IP.</p> <pre><code>Usando nmcli:\n\nbash\n</code></pre> <p>nmcli device show enp3s0 | grep DHCP</p> <p>Este comando mostrar\u00e1 informaci\u00f3n relacionada con DHCP, incluyendo la direcci\u00f3n del servidor DHCP (DHCP4.OPTION).</p> <p>Usando ip:</p> <p>bash</p> <p>ip addr show enp3s0</p> <p>Para obtener informaci\u00f3n m\u00e1s detallada sobre el proceso DHCP, puedes revisar los logs del sistema:</p> <p>bash</p> <pre><code>sudo journalctl -u NetworkManager | grep DHCP\n</code></pre> <p>b. En Windows:</p> <pre><code>Abre una Ventana de Comandos (CMD) con privilegios de administrador.\n\nEjecuta el siguiente comando:\n\ncmd\n\nipconfig /all\n\nBusca la secci\u00f3n de la interfaz de red utilizada (por ejemplo, Ethernet) y localiza la l\u00ednea \"Servidor DHCP\". Esta l\u00ednea mostrar\u00e1 la direcci\u00f3n IP del servidor que ha asignado la direcci\u00f3n IP actual.\n</code></pre> <p>c. En macOS:</p> <pre><code>Abre la Terminal.\n\nEjecuta:\n\nbash\n\nipconfig getpacket en0\n\nReemplaza en0 con la interfaz de red correspondiente si es necesario.\n\nBusca la l\u00ednea que indica el \"server_identifier\", que corresponde al servidor DHCP que ha asignado la IP.\n</code></pre> <ol> <li>Revisar el Router o Servidor DHCP</li> </ol> <p>Si tu red local utiliza un router como servidor DHCP, puedes acceder a la interfaz de administraci\u00f3n del router para ver una lista de dispositivos conectados y el servidor DHCP que est\u00e1 asignando las direcciones IP.</p> <p>Pasos Generales:</p> <pre><code>Accede a la interfaz web del router:\n    Abre un navegador web.\n    Ingresa la direcci\u00f3n IP del router en la barra de direcciones (com\u00fanmente 192.168.1.1, 192.168.0.1, 172.16.0.1, etc.).\n    Inicia sesi\u00f3n con tus credenciales de administrador.\n\nNavega a la secci\u00f3n de DHCP:\n    Busca una secci\u00f3n etiquetada como \"DHCP\", \"LAN\", \"Network\", o similar.\n    Aqu\u00ed podr\u00e1s ver una tabla de \"Clientes DHCP\" o \"Dispositivos Conectados\" que muestra qu\u00e9 dispositivos han recibido direcciones IP y desde qu\u00e9 servidor.\n\nIdentifica el Dispositivo:\n    Busca la direcci\u00f3n IP en cuesti\u00f3n y verifica qu\u00e9 dispositivo o direcci\u00f3n MAC est\u00e1 asociado a ella.\n</code></pre> <p>Nota: Si tienes m\u00faltiples servidores DHCP en la red (por ejemplo, un router y un servidor dedicado), es posible que debas revisar cada uno para identificar la fuente correcta. 3. Utilizar Herramientas de An\u00e1lisis de Red</p> <p>**a. Wireshark:</p> <p>Wireshark es una herramienta poderosa para capturar y analizar tr\u00e1fico de red. Puedes usarla para interceptar paquetes DHCP y determinar qu\u00e9 servidor est\u00e1 asignando direcciones IP.</p> <p>Pasos B\u00e1sicos:</p> <pre><code>Instala Wireshark:\n    En Linux: sudo apt install wireshark\n    En Windows y macOS: Descarga desde Wireshark.org.\n\nInicia una Captura de Paquetes:\n    Abre Wireshark y selecciona la interfaz de red que deseas monitorear (por ejemplo, enp3s0).\n\nFiltra los Paquetes DHCP:\n    En la barra de filtros, ingresa dhcp o bootp para filtrar solo los paquetes DHCP.\n\nAnaliza los Paquetes:\n    Observa los paquetes DHCP Offer y DHCP ACK para identificar la direcci\u00f3n IP del servidor DHCP (Server Identifier).\n</code></pre> <p>**b. dhcping:</p> <p>dhcping es una herramienta de l\u00ednea de comandos que puede enviar solicitudes DHCP a un servidor espec\u00edfico y verificar si est\u00e1 activo.</p> <p>Instalaci\u00f3n:</p> <pre><code>En Debian/Ubuntu:\n\nbash\n\nsudo apt install dhcping\n</code></pre> <p>Uso:</p> <p>bash</p> <p>dhcping -c  -s  <p>Este comando verifica si el servidor DHCP especificado est\u00e1 respondiendo a las solicitudes. 4. Inspeccionar la Tabla de ARP</p> <p>La Tabla ARP (Address Resolution Protocol) mapea direcciones IP a direcciones MAC. Si conoces la direcci\u00f3n MAC del servidor DHCP, puedes identificarlo en la tabla ARP.</p> <p>Comando en Linux:</p> <p>bash</p> <p>arp -a</p> <p>Busca la direcci\u00f3n IP asignada y verifica su direcci\u00f3n MAC correspondiente.</p> <p>Nota: Este m\u00e9todo es menos directo, pero puede ser \u00fatil si conoces la direcci\u00f3n MAC del servidor DHCP. 5. Consultar los Logs del Servidor DHCP</p> <p>Si tienes acceso al servidor DHCP (por ejemplo, si est\u00e1s utilizando un servidor DHCP dedicado en Linux), puedes revisar sus logs para ver qu\u00e9 dispositivos han recibido direcciones IP.</p> <p>En un servidor DHCP basado en ISC DHCP:</p> <p>Los logs suelen estar en /var/log/syslog o /var/log/messages.</p> <p>bash</p> <p>sudo grep dhcpd /var/log/syslog</p> <p>En un servidor DHCP de Windows:</p> <pre><code>Abre el Visor de Eventos.\nNavega a Registros de Windows &gt; Sistema.\nBusca eventos relacionados con DHCP.\n</code></pre> <ol> <li>Comprobar el Archivo de Leases del DHCP en el Host</li> </ol> <p>Si est\u00e1s utilizando un servidor DHCP en el mismo host (por ejemplo, dnsmasq o isc-dhcp-server), puedes revisar el archivo de leases para ver qu\u00e9 dispositivo ha recibido qu\u00e9 IP.</p> <p>Para isc-dhcp-server:</p> <p>bash</p> <p>cat /var/lib/dhcp/dhcpd.leases</p> <p>Para dnsmasq:</p> <p>bash</p> <p>cat /var/lib/misc/dnsmasq.leases</p> <ol> <li>Usar Comandos Espec\u00edficos de NetworkManager</li> </ol> <p>Si est\u00e1s usando NetworkManager, puedes obtener detalles sobre el servidor DHCP directamente desde nmcli.</p> <p>Comando:</p> <p>bash</p> <p>nmcli device show enp3s0 | grep DHCP4</p> <p>Ejemplo de Salida:</p> <p>makefile</p> <p>IP4.DHCP.SERVER:                             172.30.1.1</p> <p>Esto indica que el servidor DHCP que asign\u00f3 la IP es 172.30.1.1. 8. Identificar el Servidor DHCP mediante Scanning de Red</p> <p>Puedes usar herramientas como nmap para identificar qu\u00e9 dispositivos en la red est\u00e1n ofreciendo servicios DHCP.</p> <p>Instalaci\u00f3n de nmap:</p> <pre><code>En Linux:\n\nbash\n\nsudo apt install nmap\n</code></pre> <p>Uso de nmap para detectar servidores DHCP:</p> <p>bash</p> <p>sudo nmap --script broadcast-dhcp-discover</p> <p>Este comando env\u00eda una solicitud DHCP y espera respuestas, identificando qu\u00e9 dispositivos est\u00e1n respondiendo como servidores DHCP. Resumen de Pasos Recomendados</p> <pre><code>Verifica la Configuraci\u00f3n de Red del Dispositivo:\n    Usa nmcli, ip, ipconfig /all, o herramientas similares para identificar el servidor DHCP desde el dispositivo que ha recibido la IP.\n\nRevisa la Interfaz de Administraci\u00f3n del Router:\n    Accede al router para ver la lista de dispositivos conectados y los servidores DHCP activos.\n\nUtiliza Herramientas de An\u00e1lisis de Red:\n    Emplea Wireshark para capturar y analizar tr\u00e1fico DHCP, o usa dhcping para verificar servidores espec\u00edficos.\n\nInspecciona la Tabla ARP y Logs del Servidor DHCP:\n    Usa comandos como arp -a y revisa los logs del servidor DHCP para obtener informaci\u00f3n detallada.\n\nUtiliza nmap para Escanear la Red:\n    Identifica qu\u00e9 dispositivos est\u00e1n ofreciendo servicios DHCP en tu red local.\n</code></pre> <p>Consejos Adicionales</p> <pre><code>Aseg\u00farate de Tener los Permisos Adecuados:\n    Muchas de estas operaciones requieren privilegios de administrador o root.\n\nMant\u00e9n Documentada tu Red:\n    Si tienes m\u00faltiples servidores DHCP, aseg\u00farate de documentar su prop\u00f3sito y configuraci\u00f3n para evitar conflictos.\n\nSeguridad de DHCP:\n    Considera implementar medidas de seguridad como DHCP Snooping en redes m\u00e1s grandes para prevenir ataques de servidores DHCP no autorizados.\n</code></pre> <p>Conclusi\u00f3n</p> <p>Identificar el origen de la asignaci\u00f3n de direcciones IP en una red local implica revisar la configuraci\u00f3n de red de los dispositivos, inspeccionar el router o servidores DHCP, y utilizar herramientas de an\u00e1lisis de red para capturar y analizar tr\u00e1fico DHCP. Siguiendo los m\u00e9todos descritos anteriormente, podr\u00e1s determinar de manera efectiva qu\u00e9 dispositivo o servicio est\u00e1 asignando direcciones IP en tu red.</p>"},{"location":"01.-KVM/02.-Almacenamiento/01.-Aprovisionamiento%20ligero%20de%20discos/","title":"01.-Aprovisionamiento ligero de discos","text":"<p>Para crear una m\u00e1quina virtual cuyo espacio f\u00edsico de almacenamiento crezca seg\u00fan la demanda, ocupando menos espacio en disco  inicialmente, puedes utilizar el aprovisionamiento ligero (thin  provisioning) con im\u00e1genes de disco de expansi\u00f3n din\u00e1mica. Esto se puede lograr de la siguiente manera:</p>"},{"location":"01.-KVM/02.-Almacenamiento/01.-Aprovisionamiento%20ligero%20de%20discos/#creacion-de-la-imagen-de-disco","title":"Creaci\u00f3n de la imagen de disco","text":"<ol> <li>Utiliza el formato qcow2 (QEMU Copy-On-Write versi\u00f3n 2) para la imagen de disco:</li> </ol> <pre><code>qemu-img create -f qcow2 nombre_imagen.qcow2 tama\u00f1o_virtual\n</code></pre> <p>Por ejemplo:</p> <pre><code>qemu-img create -f qcow2 mi_vm_disco.qcow2 50G\n</code></pre> <p>Este comando crea una imagen de disco que aparecer\u00e1 como un disco  de 50 GB para la m\u00e1quina virtual, pero inicialmente ocupar\u00e1 muy poco  espacio en el host.</p>"},{"location":"01.-KVM/02.-Almacenamiento/01.-Aprovisionamiento%20ligero%20de%20discos/#configuracion-en-virt-manager","title":"Configuraci\u00f3n en virt-manager","text":"<p>Si est\u00e1s usando virt-manager para crear la VM:</p> <ol> <li>En el paso de configuraci\u00f3n del almacenamiento, selecciona \"Select or create custom storage\".</li> <li>Haz clic en \"Manage...\" y luego en \"Add Pool\" para crear un nuevo pool si es necesario.</li> <li>Selecciona el pool y haz clic en \"Create new volume\".</li> <li>En el di\u00e1logo de creaci\u00f3n de volumen: Elige el formato \"qcow2\" Establece el tama\u00f1o m\u00e1ximo deseado Aseg\u00farate de que \"Allocation\" est\u00e9 configurado en 0 para thin provisioning</li> </ol>"},{"location":"01.-KVM/02.-Almacenamiento/01.-Aprovisionamiento%20ligero%20de%20discos/#configuracion-en-linea-de-comandos","title":"Configuraci\u00f3n en l\u00ednea de comandos","text":"<p>Si prefieres usar la l\u00ednea de comandos:</p> <ol> <li>Crea la imagen de disco como se mostr\u00f3 anteriormente.</li> <li>Al definir la VM con <code>virt-install</code>, usa la opci\u00f3n <code>--disk</code>:</li> </ol> <pre><code>textvirt-install --name mi_vm --memory 2048 --vcpus 2 \\\n  --disk path=/ruta/a/mi_vm_disco.qcow2,format=qcow2,bus=virtio \\\n  --os-variant=rhel8.0 \\\n  # ... otras opciones necesarias\n</code></pre>"},{"location":"01.-KVM/02.-Almacenamiento/01.-Aprovisionamiento%20ligero%20de%20discos/#ventajas-del-aprovisionamiento-ligero","title":"Ventajas del aprovisionamiento ligero","text":"<ul> <li>Eficiencia en el uso del espacio: La imagen solo crecer\u00e1 cuando se escriban datos reales en el disco virtual.</li> <li>Flexibilidad: Puedes \"sobreprovisionar\" el almacenamiento, asignando m\u00e1s espacio virtual del que f\u00edsicamente tienes disponible.</li> </ul>"},{"location":"01.-KVM/02.-Almacenamiento/01.-Aprovisionamiento%20ligero%20de%20discos/#consideraciones-importantes","title":"Consideraciones importantes","text":"<ol> <li>Monitoreo: Es crucial monitorear el crecimiento real de las im\u00e1genes para evitar quedarse sin espacio en el host.</li> <li>Rendimiento: Las im\u00e1genes de expansi\u00f3n din\u00e1mica pueden tener un ligero impacto en el rendimiento comparado con im\u00e1genes de tama\u00f1o fijo.</li> <li>Fragmentaci\u00f3n: Con el tiempo, estas im\u00e1genes pueden fragmentarse, lo que puede afectar el rendimiento.</li> <li>Compactaci\u00f3n: Peri\u00f3dicamente, puedes necesitar compactar las im\u00e1genes para liberar espacio no utilizado:</li> </ol> <pre><code>text\nqemu-img convert -O qcow2 imagen_original.qcow2 imagen_compactada.qcow2\n</code></pre> <p>Utilizando estas t\u00e9cnicas, podr\u00e1s crear m\u00e1quinas virtuales que  inicialmente ocupen poco espacio en disco y crezcan seg\u00fan sea necesario, optimizando el uso del almacenamiento en tu sistema host.</p>"},{"location":"02.-DHCP/","title":"Index","text":"<ul> <li>DHCP: Network protocol that automatically assigns IP addresses and communication settings.</li> <li>Client-server model: DHCP server assigns IPs, while devices (clients) request them.</li> <li>Simplification: Removes the need for manual device configuration.</li> <li>Scalability: Used in networks of all sizes, from small home setups to large infrastructures (ISPs, campuses).</li> <li>Compatibility: Supports both IPv4 and IPv6 (known as DHCPv6).</li> <li>Routers: Many home routers include a built-in DHCP server.</li> </ul>"},{"location":"02.-DHCP/01.-History/","title":"01.-History","text":"<ul> <li>1984: Definition of Reverse Address Resolution Protocol (RARP)</li> <li> <p>Used for configuring IP addresses on simple devices</p> <ul> <li>Limited by the requirement of a server on each network link</li> </ul> </li> <li> <p>1985: Introduction of Bootstrap Protocol (BOOTP)</p> </li> <li> <p>Improved upon RARP by allowing packet forwarding across networks</p> </li> <li> <p>Enabled a central BOOTP server to serve multiple subnets</p> </li> <li> <p>October 1993: First definition of DHCP</p> </li> <li> <p>Based on BOOTP but allows dynamic allocation of IP addresses</p> </li> <li>Can reclaim unused addresses</li> <li> <p>Provides additional configuration parameters</p> </li> <li> <p>1997: Significant update to DHCP</p> </li> <li> <p>Addition of the DHCPINFORM message and other minor changes</p> </li> <li> <p>This version remains the core standard for IPv4 networks</p> </li> <li> <p>2003: Initial definition of DHCPv6 for IPv6 networks</p> </li> <li>2018: New definition of DHCPv6</li> <li>Merges prefix delegation and stateless address autoconfiguration</li> </ul>"},{"location":"02.-DHCP/04.-Client%20configuration%20parameters/","title":"04.-Client configuration parameters","text":""},{"location":"02.-DHCP/04.-Client%20configuration%20parameters/#overview","title":"Overview","text":"<ul> <li>DHCP servers can provide optional configuration parameters to clients</li> <li>Defined by Internet Assigned Numbers Authority (IANA)</li> <li>Described in RFC 2132</li> </ul>"},{"location":"02.-DHCP/04.-Client%20configuration%20parameters/#key-points","title":"Key Points","text":"<ul> <li>Clients can select, manipulate, and overwrite server-provided parameters</li> <li>In Unix-like systems, client-level refinement typically occurs in <code>/etc/dhclient.conf</code></li> </ul>"},{"location":"02.-DHCP/04.-Client%20configuration%20parameters/#common-dhcp-options","title":"Common DHCP Options","text":"<ul> <li>Subnet mask</li> <li>Router (default gateway)</li> <li>Domain name servers</li> <li>Host name</li> <li>Domain name</li> <li>Broadcast address</li> <li>Network Time Protocol servers</li> <li>Time offset</li> <li>NetBIOS name servers</li> <li>NetBIOS node type</li> </ul>"},{"location":"02.-DHCP/04.-Client%20configuration%20parameters/#advanced-options","title":"Advanced Options","text":"<ul> <li>Static routes</li> <li>Vendor-specific options</li> <li>TFTP server name</li> <li>Bootfile name</li> </ul>"},{"location":"02.-DHCP/04.-Client%20configuration%20parameters/#client-customization","title":"Client Customization","text":"<ul> <li>Clients can request specific options from the server</li> <li>Can override or supplement server-provided options</li> <li>Allows for fine-tuning of network configuration</li> </ul>"},{"location":"02.-DHCP/04.-Client%20configuration%20parameters/#importance","title":"Importance","text":"<ul> <li>Enables centralized management of network configuration</li> <li>Facilitates automatic and dynamic network setup</li> <li>Supports diverse client requirements within a single network</li> </ul>"},{"location":"02.-DHCP/02.-Overview/","title":"Index","text":"<ul> <li>Protocol that defines how devices communicate within and across local networks on the Internet</li> <li>Allows DHCP servers to automatically and dynamically manage IP settings for devices on a local network</li> </ul>"},{"location":"02.-DHCP/02.-Overview/01.-How%20DHCP%20Works/","title":"01.-How DHCP Works","text":"<ul> <li>Uses client-server model</li> <li>DHCP client (device) sends broadcast query requesting network information</li> <li> <p>DHCP server responds with:</p> <ul> <li>IP address</li> <li>Default gateway</li> <li>Domain name</li> <li>Name servers</li> <li>Time servers</li> <li>Lease duration</li> </ul> </li> </ul>"},{"location":"02.-DHCP/02.-Overview/02.-IP%20Address%20Allocation%20Methods/","title":"02.-IP Address Allocation Methods","text":"<ul> <li> <p>Dynamic allocation</p> <ul> <li>Administrator reserves IP range</li> <li>Addresses leased for controllable time period</li> <li>Unused addresses can be reclaimed and reallocated</li> </ul> </li> <li> <p>Automatic allocation</p> <ul> <li>Server permanently assigns address from defined range</li> <li>Preferentially assigns same address to returning clients</li> </ul> </li> <li> <p>Manual allocation (static DHCP)</p> <ul> <li>Administrator maps unique client identifier to specific IP address</li> <li>Also called reservation or MAC/IP address binding</li> </ul> </li> </ul>"},{"location":"02.-DHCP/02.-Overview/03.-Additional%20Notes/","title":"03.-Additional Notes","text":"<ul> <li>Used for both IPv4 and IPv6</li> <li>IPv6 devices may also use stateless address autoconfiguration</li> <li>IPv6 hosts can use link-local addressing for local network operations</li> </ul>"},{"location":"02.-DHCP/03.-Operation%20Process/","title":"Index","text":"<ul> <li>Uses User Datagram Protocol (UDP)</li> <li>Server listens on port 67, client on port 68</li> <li>Four phases: Discovery, Offer, Request, Acknowledgement (DORA)</li> </ul>"},{"location":"02.-DHCP/03.-Operation%20Process/01.-Discovery/","title":"01.-Discovery","text":"<ul> <li>Client broadcasts DHCPDISCOVER message</li> <li>Uses destination address 255.255.255.255 or subnet broadcast address</li> <li>May request specific IP address</li> </ul>"},{"location":"02.-DHCP/03.-Operation%20Process/02.-Offer/","title":"02.-Offer","text":"<ul> <li>Server responds with DHCPOFFER message</li> <li> <p>Contains:</p> <ul> <li>Client's MAC address</li> <li>Offered IP address</li> <li>Subnet mask</li> <li>Lease duration</li> <li>Server's IP address</li> </ul> </li> </ul>"},{"location":"02.-DHCP/03.-Operation%20Process/03.-Request/","title":"03.-Request","text":"<ul> <li>Client replies with DHCPREQUEST message</li> <li>Broadcasts to server, requesting offered address</li> <li>Includes server identification</li> <li>Other DHCP servers withdraw their offers</li> </ul>"},{"location":"02.-DHCP/03.-Operation%20Process/04.-Acknowledgement/","title":"04.-Acknowledgement","text":"<ul> <li>Server sends DHCPACK packet</li> <li> <p>Includes:</p> <ul> <li>Lease duration</li> <li>Any other requested configuration information</li> </ul> </li> </ul>"},{"location":"02.-DHCP/03.-Operation%20Process/05.-Additional%20Steps/","title":"05.-Additional Steps","text":"<ul> <li> <p>IP Address Selection:</p> <ul> <li>Server may ping address to check availability</li> <li>Client should probe address (e.g., with ARP) before use</li> </ul> </li> <li> <p>Information Request:</p> <ul> <li>Client can request additional information</li> <li>Example: Browsers use DHCP Inform for web proxy settings</li> </ul> </li> <li> <p>Release:</p> <ul> <li>Client can send request to release DHCP information</li> <li>Not mandatory, as clients may disconnect unexpectedly</li> </ul> </li> </ul>"},{"location":"02.-DHCP/05.-DHCP%20Options/","title":"Index","text":"<p>DHCP options are variable-length octet strings using Type-Length-Value (TLV) encoding. Each option consists of:</p> <ul> <li>Option code (first octet)</li> <li>Length (second octet)</li> <li>Value (remaining octets)</li> </ul>"},{"location":"02.-DHCP/05.-DHCP%20Options/01.-Main%20Categories%20of%20DHCP%20Options/","title":"01.-Main Categories of DHCP Options","text":"<p>IP Layer Parameters</p> <ul> <li>Per host: IP forwarding, non-local source routing, policy filter</li> <li>Per interface: MTU, mask discovery, router discovery</li> </ul> <p>Link Layer Parameters</p> <ul> <li>Trailer encapsulation, ARP cache timeout, Ethernet encapsulation</li> </ul> <p>TCP Parameters</p> <ul> <li>Default TTL, keepalive interval, keepalive garbage</li> </ul> <p>Application and Service Parameters</p> <ul> <li>NTP servers, NetBIOS name servers, SMTP servers</li> </ul>"},{"location":"02.-DHCP/05.-DHCP%20Options/02.-Important%20DHCP%20Extensions/","title":"02.-Important DHCP Extensions","text":"<ul> <li>Requested IP address</li> <li>IP address lease time</li> <li>DHCP message type</li> <li>Server identifier</li> <li>Maximum DHCP message size</li> </ul>"},{"location":"02.-DHCP/05.-DHCP%20Options/03.-DHCP%20Message%20Types/","title":"03.-DHCP Message Types","text":"Code Name Description 1 DHCPDISCOVER Client searches for a DHCP server 2 DHCPOFFER Server offers an IP address 3 DHCPREQUEST Client requests the offered address 5 DHCPACK Server confirms the assignment"},{"location":"02.-DHCP/05.-DHCP%20Options/04.-Client%20Vendor%20Identification/","title":"04.-Client Vendor Identification","text":"<ul> <li>Option 60: Vendor Class Identifier (VCI)</li> <li>Allows client to communicate its hardware or firmware type</li> <li>Helps server provide specific configurations</li> </ul>"},{"location":"02.-DHCP/05.-DHCP%20Options/05.-Other%20Relevant%20Extensions/","title":"05.-Other Relevant Extensions","text":"<ul> <li>User class</li> <li>Relay agent information</li> <li>Novell Directory Services (NDS) servers</li> <li>Time zone</li> <li>DHCP Captive-Portal</li> </ul>"},{"location":"02.-DHCP/06.-Relaying/","title":"Index","text":"<p>DHCP relay agents are essential in networks where DHCP servers manage IP addresses for multiple subnets. They enable communication between DHCP clients and servers that are not on the same subnet.</p> <p>Key Functions:</p> <ul> <li>Installed on subnets not directly served by DHCP servers</li> <li>Run on network devices capable of routing between client and server subnets</li> <li>Receive broadcast messages from DHCP clients and forward them to DHCP servers using unicast</li> </ul>"},{"location":"02.-DHCP/06.-Relaying/01.-DHCP%20Relay%20Process/","title":"01.-DHCP Relay Process","text":"<ol> <li>Client Broadcast: DHCP client broadcasts on the local subnet.</li> <li>Relay Agent Reception: Relay agent receives the broadcast.</li> <li>Forwarding to Server: Relay agent transmits the request to DHCP servers using unicast.</li> <li>GIADDR Field: Relay agent inserts its own IP address in the GIADDR field of the DHCP packet.</li> <li>Server Response: DHCP server uses GIADDR to determine the subnet and address pool.</li> <li>Reply Transmission: Server sends reply to the GIADDR address using unicast.</li> <li>Client Delivery: Relay agent retransmits the response to the client, usually via unicast.</li> </ol>"},{"location":"02.-DHCP/06.-Relaying/02.-Special%20Considerations/","title":"02.-Special Considerations","text":"<ul> <li>Clients may set the broadcast bit in DHCPDISCOVER packets if they can't accept unicast packets without an IP address.</li> <li>Communication between relay agent and DHCP server typically uses UDP port 67 for both source and destination.</li> </ul>"},{"location":"02.-DHCP/06.-Relaying/04.-Benefits/","title":"04.-Benefits","text":"<ul> <li>Enables DHCP functionality across multiple subnets without requiring a DHCP server on each subnet.</li> <li>Allows centralized management of IP address allocation for large networks.</li> </ul>"},{"location":"02.-DHCP/06.-Relaying/08.-Client%20states/","title":"08.-Client states","text":"<p>A DHCP client can receive these messages from a server: - DHCPOFFER - DHCPACK - DHCPNAK ![[Pasted image 20240919141503.png]]</p> <p>The client moves through DHCP states depending on how the server responds to the messages that the client sends.</p>"},{"location":"99.-Caj%C3%B3n%20Desastre/01.-Publicaci%C3%B3n%20con%20MkDocs/01.-Crear%20proyecto%20en%20GitHub/","title":"Crear proyecto en GitHub","text":""},{"location":"99.-Caj%C3%B3n%20Desastre/01.-Publicaci%C3%B3n%20con%20MkDocs/01.-Crear%20proyecto%20en%20GitHub/#crear-un-nuevo-repositorio-en-github","title":"Crear un nuevo repositorio en GitHub","text":"<ol> <li>Inicia sesi\u00f3n en tu cuenta de GitHub.</li> <li>En la esquina superior derecha de cualquier p\u00e1gina, haz clic en el s\u00edmbolo \"+\" y selecciona \"Nuevo repositorio\".</li> <li>Escribe un nombre corto y descriptivo para tu repositorio.</li> <li>Opcionalmente, a\u00f1ade una descripci\u00f3n del proyecto.</li> <li>Elige la visibilidad del repositorio (p\u00fablico o privado).</li> <li>No selecciones la opci\u00f3n de inicializar el repositorio con un README, ya que vas a subir un proyecto existente.</li> <li>Haz clic en \"Crear repositorio\".</li> </ol>"},{"location":"99.-Caj%C3%B3n%20Desastre/01.-Publicaci%C3%B3n%20con%20MkDocs/01.-Crear%20proyecto%20en%20GitHub/#subir-tu-proyecto-local-a-github","title":"Subir tu proyecto local a GitHub","text":"<p>Una vez creado el repositorio, GitHub te mostrar\u00e1 instrucciones para subir un proyecto existente. Sigue estos pasos en tu terminal local:</p> <ol> <li> <p>Abre la terminal y navega al directorio de tu proyecto local.</p> </li> <li> <p>Inicializa el repositorio Git local (si a\u00fan no lo has hecho):    <code>git init</code></p> </li> <li> <p>A\u00f1ade todos los archivos de tu proyecto al repositorio:    <code>git add .</code></p> </li> <li> <p>Realiza el primer commit:    <code>git commit -m \"Primer commit: Subida inicial del proyecto\"</code></p> </li> <li> <p>A\u00f1ade la URL del repositorio remoto de GitHub:    <code>git remote add origin https://github.com/tu-usuario/nombre-del-repositorio.git</code></p> </li> <li> <p>Cambia el nombre de la rama principal de master a main:</p> </li> </ol> <p><code>bash    git branch -M main</code></p> <ol> <li>Sube los cambios al repositorio remoto:</li> </ol> <p><code>git push -u origin main</code></p>"},{"location":"99.-Caj%C3%B3n%20Desastre/01.-Publicaci%C3%B3n%20con%20MkDocs/01.-Crear%20proyecto%20en%20GitHub/#verificacion","title":"Verificaci\u00f3n","text":"<p>Despu\u00e9s de completar estos pasos, actualiza la p\u00e1gina de tu repositorio en GitHub. Deber\u00edas ver todos los archivos de tu proyecto local ahora en GitHub.</p>"},{"location":"99.-Caj%C3%B3n%20Desastre/01.-Publicaci%C3%B3n%20con%20MkDocs/01.-Crear%20proyecto%20en%20GitHub/#recomendaciones-adicionales","title":"Recomendaciones adicionales","text":"<ul> <li>Si tu proyecto incluye archivos grandes o sensibles, considera usar un archivo <code>.gitignore</code> para excluirlos del control de versiones.</li> <li>Aseg\u00farate de tener un README.md en tu proyecto que explique qu\u00e9 hace y c\u00f3mo utilizarlo.</li> <li>Si est\u00e1s utilizando GitHub Pages para publicar tu sitio, aseg\u00farate de que tu estructura de archivos sea correcta y que tengas un archivo <code>index.html</code> en la ra\u00edz o en la carpeta <code>/docs</code>, dependiendo de tu configuraci\u00f3n.</li> </ul>"}]}